webpackJsonp([1],{"/tZb":function(e,t){},0:function(e,t){},"28BC":function(e,t,s){e.exports=s.p+"static/img/mainbg.2998913.jpg"},"7/MD":function(e,t){},DWFB:function(e,t){},ENLC:function(e,t){},EUih:function(e,t){},EVuS:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAIAAACRXR/mAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkQ5NUQ1RTlEMjc5MzExRThBMjBBRTk2QjREMDYzODdCIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkQ5NUQ1RTlFMjc5MzExRThBMjBBRTk2QjREMDYzODdCIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RDk1RDVFOUIyNzkzMTFFOEEyMEFFOTZCNEQwNjM4N0IiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RDk1RDVFOUMyNzkzMTFFOEEyMEFFOTZCNEQwNjM4N0IiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7CNuTkAAACmElEQVR42uyZy2sTURTGv0zalJJixVIpBl+tUB9UpQa3LqQLwZUIutGV4MaVK0HBjf4BhaJQChaFgiAuRFAQA4IbpdZHsRqpLVaFkGg1oXH6cBq/IdBV52bunTlDkHzrmXN/c+693zn3TqxSqaD+ZKEu1cBqYDWw/h8sexWTf8LEagry8p0Cxn7gWcnFqqqrGQMbcaELh9sCYcXMXP7lAs7P4E3Z84FTHbjRjU1NEWIxSWRay5CXtrXg0R7sbY0E60kRxz7A8fdSKoHX+9HZLLzk5//i9Ce/TNT3ZZydlt+J17+5ZFp6/NtNsCAWkzRaMPn0mzlJrExJO1VrCVuuiGFNmRom9+zsohhWYcXcHrn267EmJiwxLNqjsWhgUlgsdmbi9+xsEcNi6INJEyzWR1k7vZzSHqAtjotbhLFOdmCgXW+Aa1vdbke8VBcdpN9h2p8PnenE7V2RdKftcbzow5ENtZ+8lMKtnmjbQNbH4Tyufl3fYw8kMbjDF3rIdspGeazg6ftvy7gyh0zRHEs7WwsOzn3G3Z9+rWGkx92MslhZGyeymLI1BmDTfL8Xva1iWJy44x/dbBlY18PdekvNL9arMo6+d93BTNy/T/fhUDJULC7t9CTmlgI1EayM431+jxu+diLXeEAmihEYJzSD4KZ78CucrotxfG7hGpPIHrx7Qru3VDdeM/1IxIJlaygXJlO1ex7KBcsWK8z2iZCxqgn70o94zDRb9+bDZ6omjJHNJ3E0L3XiqBnZcxJ5Ut08rnHdoCXOYD6tumayFEdhR+z/BiMzvskkPi/JnhzV8S1FYRZVxgDLXkV2URaLpwHFfaLl1Vc5wj/OGD9ra2LNLiECKUZZHyu3EgWWwqstL9OKQIqm8p8AAwDvVQFqIjiKfAAAAABJRU5ErkJggg=="},FP4z:function(e,t){},HBSQ:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("7+uW"),r={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var i=s("VU/8")({name:"App"},r,!1,function(e){s("rjtC")},null,null).exports,o=s("/ocq"),n={name:"headPortrait",props:["userId","isSave","imgUrl","indexPath"],data:function(){return{}},computed:{url:function(){return this.isSave?this.imgUrl?"http://"+this.$store.state.statisFileIp+this.imgUrl:null===this.userId?"":"http://"+this.$store.state.statisFileIp+"/headProtrait/"+this.userId+".jpg":this.imgUrl?"http://"+this.$store.state.statisFileIp+this.imgUrl+"?time="+(new Date).getTime():null===this.userId?"":"http://"+this.$store.state.statisFileIp+"/headProtrait/"+this.userId+".jpg?time="+(new Date).getTime()}},methods:{imgClick:function(){this.$emit("imgClick",this.indexPath)}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"headPortrait"},[a("img",{staticClass:"headImg",attrs:{src:s("EVuS"),alt:""},on:{click:function(t){return t.stopPropagation(),e.imgClick(t)}}}),e._v(" "),a("img",{ref:"uerHead",class:{headImg:!0,userHeadImg:!0,yourHead:e.userId===this.$store.state.userId},attrs:{src:e.url,alt:""},on:{click:function(t){return t.stopPropagation(),e.imgClick(t)}}})])},staticRenderFns:[]};var d=s("VU/8")(n,c,!1,function(e){s("SmrQ")},null,null).exports,l={name:"myHead",data:function(){return{activeIndex:"1",userOperateArr:[{label:"个人中心",value:1},{label:"帮助中心",value:2},{label:"关于nsc",value:3},{label:"退出账号",value:4}]}},computed:{socket:function(){return this.$store.state.socket}},methods:{mainOperate:function(e){1===e?this.$router.push({name:"personal"}):4===e&&(this.$store.state.socket.emit("img"),this.$router.push({name:"login"}))},transformPath:function(e){switch(e){case"1":return"home";case"2":return"myMessage";case"3-1":return"myFriend";case"3-2":return"myGroups";default:return""}},handleSelect:function(e,t){this.$router.push({name:this.transformPath(e)})}},mounted:function(){},watch:{socket:{handler:function(e){var t=this;e&&(this.$store.state.socket.removeAllListeners("getMessage"),this.$store.state.socket.on("getMessage",function(e){e.groupId?t.$notify({title:"群聊消息:"+e.groupName,dangerouslyUseHTMLString:!0,message:"<p>"+e.uName+':</p><div style="text-indent:2em;">'+(3===e.messageType?"[图像]":4===e.messageType?"[文件]":e.message)+"</div> ",duration:5e3}):t.$notify({title:"好友消息",dangerouslyUseHTMLString:!0,message:"<p>"+(e.friendName||e.from)+':</p><div style="text-indent:2em;">'+(3===e.messageType?"[图像]":4===e.messageType?"[文件]":e.message)+"</div> ",duration:5e3})}))},deep:!0}},components:{headPortrait:d}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"my-head"},[a("img",{staticClass:"logo",attrs:{src:s("bIQm"),alt:""}}),e._v(" "),a("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":e.activeIndex,mode:"horizontal","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.handleSelect}},[a("el-menu-item",{attrs:{index:"1"}},[e._v("主页")]),e._v(" "),a("el-menu-item",{attrs:{index:"2"}},[e._v("我的消息")]),e._v(" "),a("el-submenu",{attrs:{index:"3"}},[a("template",{slot:"title"},[e._v("联系人")]),e._v(" "),a("el-menu-item",{attrs:{index:"3-1"}},[e._v("我的好友")]),e._v(" "),a("el-menu-item",{attrs:{index:"3-2"}},[e._v("我的群")])],2),e._v(" "),a("el-menu-item",{attrs:{index:"4"}},[e._v("消息中心")])],1),e._v(" "),a("div",{staticClass:"user"},[a("span",{staticClass:"username"},[e._v(e._s(e.$store.state.nickName||e.$store.state.userId))]),e._v(" "),a("el-dropdown",{on:{command:e.mainOperate}},[a("div",[a("headPortrait",{attrs:{userId:e.$store.state.userId}})],1),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.userOperateArr,function(t){return a("el-dropdown-item",{key:t.value,attrs:{command:t.value}},[e._v(e._s(t.label))])}))],1)],1)],1)},staticRenderFns:[]};var p=s("VU/8")(l,u,!1,function(e){s("YVzM")},null,null).exports,m=s("fZjL"),g=s.n(m),h=s("wi/X"),f=s.n(h),v=function(e,t,s){if(void 0!=s){var a=new Date;a.setTime(a.getTime()+24*s*60*60*1e3);var r="expires="+a.toGMTString();document.cookie=e+"="+t+"; "+r}else document.cookie=e+"="+t+"; "},I=function(e){var t=[],s=e.match(/\{[0-9a-zA-Z]+(\-\g+){0,1}\}/gi);return s&&s.forEach(function(e){t.push(e.split("}")[0].split("{")[1])}),t},_=function(e,t,s,a){return 1===e?s.constructor===Array?s.forEach(function(e,s){var a=new RegExp("{"+e.name+"}","ig");t=t.replace(a,'<img src="data:image/png;base64,'+e.img+'" />')}):alert("imgArr不是数组"):2===e&&(console.log(s),s.constructor===Array?s.forEach(function(e,s){var r=new RegExp("{"+e.split(".")[0]+"}","ig");t=t.replace(r,'<img src="http://'+a+"/express/"+e+'" />')}):alert("imgArr不是数组")),t},k=function(e){e.scrollTop=e.scrollHeight-e.offsetHeight};var w={name:"home",data:function(){return{pc:null,other:null,videoStreamTrack:null,audioStreamTrack:null}},computed:{socket:function(){return this.$store.state.socket}},methods:{closeVideo:function(){this.pc.close(),this.videoStreamTrack.stop(),this.audioStreamTrack.stop(),this.socket.emit("closeVideo",this.other),this.$store.state.isVideo=!1},videoCall:function(e,t){var s=this;this.other=t;var a=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection,r=window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription;this.pc=new a({iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:numb.viagenie.ca",username:"webrtc@live.com",credential:"muazkh"}]}),this.pc.onicecandidate=function(e){null!==e.candidate&&(console.log("event.candidate:"+e.candidate),s.socket.emit("_ice_candidate",{candidate:e.candidate,to:t}))},this.pc.onaddstream=function(e){console.log("event.stream:"+e.stream),console.log("hisVideoSrc:"+URL.createObjectURL(e.stream)),s.$refs.hisVideo.src=URL.createObjectURL(e.stream)};var i=function(e){s.pc.setLocalDescription(e),console.log("发送offer请求信令 desc:"+e),s.socket.emit("_offer",{sdp:e,to:t})},o=function(e){s.pc.setLocalDescription(e),console.log("回答信令 desc:"+e),s.socket.emit("_answer",{sdp:e,to:t})};navigator.getUserMedia=navigator.getUserMedia||navigator.msGetUserMedia||navigator.webkitGetUserMedia||navigator.mediaDevices.getUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia({audio:!0,video:!0},function(t){s.audioStreamTrack=t.getTracks()[0],s.videoStreamTrack=t.getTracks()[1],console.log("yourVideoSrc:"+URL.createObjectURL(t)),s.$refs.yourVideo.src=URL.createObjectURL(t),s.pc.addStream(t),e&&s.pc.createOffer(i,function(e){console.log("Failure callback: "+e)})},function(e){console.log("getUserMedia error: "+e)}),this.socket.on("_ice_candidate",function(e){var t=e;s.pc.addIceCandidate(new RTCIceCandidate(t.candidate))}),this.socket.on("_offer",function(e){var t=e;s.pc.setRemoteDescription(new r(t.sdp)),s.pc.createAnswer(o,function(e){console.log("Failure callback: "+e)})}),this.socket.on("_answer",function(e){var t=e;s.pc.setRemoteDescription(new r(t.sdp))}),this.socket.on("closeVideo",function(e){s.$message({message:"对方关闭了视频聊天",type:"success"}),s.pc.close(),s.videoStreamTrack.stop(),s.audioStreamTrack.stop(),s.$store.state.isVideo=!1})}},watch:{socket:function(e){var t=this;e&&(e.removeAllListeners("videoRequest"),e.on("videoRequest",function(s){if(!document.getElementsByClassName(s.from.id+"Requset")[0]){var a=t.$notify({title:"提示",showClose:!1,dangerouslyUseHTMLString:!0,message:"<p>"+s.from.name+'向您发起视频请求</p><button class="operateVideoRequest '+s.from.id+'Requset">拒绝</button><button class="operateVideoRequest '+s.from.id+'Requset">同意</button>',duration:0}),r=document.getElementsByClassName(s.from.id+"Requset");console.log(t.$notify),r[0].onclick=function(){a.close(),t.$message({type:"danger",message:"已拒绝视频通话请求"})},r[1].onclick=function(){t.$store.state.isVideo?t.$message.error("只能同时与一个人进行视频通话"):(a.close(),t.$store.state.isVideo=!0,e.emit("agreeVideoRequest",s),t.videoCall(!1,s.from))}}}),e.on("agreeVideoRequest",function(e){t.$store.state.isVideo=!0,t.videoCall(!0,e.to)}))}},mounted:function(){var e=this;document.oncontextmenu=function(e){e.preventDefault()},this.$store.state.userId?this.$store.dispatch("connectSocket"):null!==sessionStorage.getItem("userId")&&null!==sessionStorage.getItem("password")?this.$http.post("/login.do",{userId:sessionStorage.getItem("userId"),password:sessionStorage.getItem("password")}).then(function(t){t.data.success&&(e.$store.state.userId=sessionStorage.getItem("userId"),e.$store.state.nickName=t.data.data.U_NickName||"",v("userId",sessionStorage.getItem("userId")),e.$store.dispatch("connectSocket"))}):(this.$message.error("请重新登录"),this.$router.push({name:"login"}))},components:{myHead:p}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("img",{staticClass:"main-bg",attrs:{src:s("28BC"),alt:""}}),e._v(" "),e.$store.state.isVideo?a("div",{staticClass:"video-group"},[a("video",{ref:"yourVideo",staticClass:"video video1",attrs:{src:"",autoplay:""}}),e._v(" "),a("video",{ref:"hisVideo",staticClass:"video video2",attrs:{src:"",autoplay:""}}),e._v(" "),a("i",{staticClass:"el-icon-close",on:{click:e.closeVideo}})]):e._e(),e._v(" "),a("myHead"),e._v(" "),a("div",{staticClass:"content"},[a("router-view")],1)],1)},staticRenderFns:[]};var b=s("VU/8")(w,y,!1,function(e){s("vZcv")},null,null).exports,P={name:"login",data:function(){return{isRegister:!1,isLoading:!1,userId:"",password:"",registerParams:{userId:"",fPassword:"",sPassword:"",email:""},tip:{userId:0,fPassword:0,sPassword:0,email:0}}},mounted:function(){sessionStorage.clear(),this.$store.state.userId=null,this.$store.state.nickName=null,this.$store.state.socket=null,"true"==localStorage.isRemember&&(this.$refs.remember.checked=!0,this.userId=localStorage.userId,this.password=localStorage.password)},methods:{checkEmail:function(){""!==this.registerParams.email?new RegExp(/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/i).test(this.registerParams.email)?this.tip.email=0:this.tip.email=1:this.tip.email=2},checkSPassword:function(){""!==this.registerParams.sPassword?this.registerParams.fPassword===this.registerParams.sPassword||""===this.registerParams.fPassword?(this.tip.sPassword=0,this.tip.fPassword=0):this.tip.sPassword=1:this.tip.sPassword=2},checkFPassword:function(){""!==this.registerParams.fPassword?this.registerParams.fPassword===this.registerParams.sPassword||""===this.registerParams.sPassword?(this.tip.fPassword=0,this.tip.sPassword=0):this.tip.fPassword=1:this.tip.fPassword=2},checkuserId:function(){var e=this;""!=this.registerParams.userId?this.$http.get("/checkuserId.do",{params:{userId:this.registerParams.userId}}).then(function(t){t.data.success&&(0==t.data.data.length?e.tip.userId=3:e.tip.userId=1)}):this.tip.userId=2},register:function(){var e=this;g()(this.registerParams).forEach(function(t){""==e.registerParams[t]&&(e.tip[t]=2)}),3==this.tip.userId&&0==this.tip.email&&0==this.tip.fPassword&&0==this.tip.sPassword&&this.$http.get("/register.do",{params:{userId:this.registerParams.userId,password:this.registerParams.fPassword,email:this.registerParams.email}}).then(function(t){t.data.success&&(e.$message({message:"注册成功",type:"success"}),e.isRegister=!1)})},clickRemember:function(){localStorage.isRemember=this.$refs.remember.checked,"true"!=localStorage.isRemember?(localStorage.userId="",localStorage.password=""):(localStorage.userId=this.userId,localStorage.password=this.password)},login:function(){var e=this;"true"===localStorage.isRemember&&(localStorage.userId=this.userId,localStorage.password=this.password),""!=this.userId&&""!=this.password?(this.isLoading=!0,this.$http.post("/login.do",{userId:this.userId,password:this.password}).then(function(t){e.isLoading=!1,t.data.success&&(sessionStorage.setItem("userId",e.userId),sessionStorage.setItem("password",e.password),e.$store.state.userId=e.userId,e.$store.state.nickName=t.data.data.U_NickName||"",v("userId",e.userId),e.$router.push({name:"home"}))})):this.$message.error("账号和密码不能为空")}},watch:{isRegister:function(e){if(e)this.tip={userId:0,fPassword:0,sPassword:0,email:0},this.registerParams={userId:"",fPassword:"",sPassword:"",email:""};else{if("true"===function(e){for(var t=e+"=",s=document.cookie.split(";"),a=0;a<s.length;a++){var r=s[a].trim();if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}("isRemember"))return;this.userId="",this.password=""}}}},F={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login"},[s("div",{staticClass:"warp"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isRegister,expression:"!isRegister"}],staticClass:"login-warp"},[s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"userId"}},[e._v("账号:")]),e._v(" "),s("el-input",{attrs:{id:"userId"},model:{value:e.userId,callback:function(t){e.userId=t},expression:"userId"}})],1),e._v(" "),s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"password"}},[e._v("密码:")]),e._v(" "),s("el-input",{attrs:{id:"password",type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),e._v(" "),s("div",{staticClass:"input-group clearfix"},[s("input",{ref:"remember",staticClass:"fl",attrs:{id:"remember",type:"checkbox"},on:{click:e.clickRemember}}),e._v(" "),s("label",{staticClass:"fl",attrs:{for:"remember"}},[e._v("记住密码")]),e._v(" "),s("a",{staticClass:"forget fr",attrs:{href:"javascript:;"}},[e._v("忘记密码")])]),e._v(" "),s("div",{staticClass:"input-group"},[s("el-button",{attrs:{disabled:e.isLoading,loading:e.isLoading,type:"primary"},on:{click:e.login}},[e._v("登录")])],1),e._v(" "),s("div",{staticClass:"input-group"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.isRegister=!0}}},[e._v("注册")])],1)]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isRegister,expression:"isRegister"}],staticClass:"register-warp"},[s("label",{attrs:{for:"ruserId"}},[e._v("账号:")]),e._v(" "),s("el-input",{attrs:{id:"ruserId"},on:{blur:e.checkuserId},model:{value:e.registerParams.userId,callback:function(t){e.$set(e.registerParams,"userId",t)},expression:"registerParams.userId"}}),e._v(" "),s("div",{staticClass:"alerts"},[1==e.tip.userId?s("el-alert",{attrs:{title:"该用户已注册",type:"error",closable:!1}}):e._e(),e._v(" "),3==e.tip.userId?s("el-alert",{attrs:{title:"可以注册",type:"success",closable:!1}}):e._e(),e._v(" "),2==e.tip.userId?s("el-alert",{attrs:{title:"用户名不能为空",type:"error",closable:!1}}):e._e()],1),e._v(" "),s("label",{attrs:{for:"rFPassword"}},[e._v("密码:")]),e._v(" "),s("el-input",{attrs:{id:"rFPassword",type:"password"},on:{blur:e.checkFPassword},model:{value:e.registerParams.fPassword,callback:function(t){e.$set(e.registerParams,"fPassword",t)},expression:"registerParams.fPassword"}}),e._v(" "),s("div",{staticClass:"alerts"},[1==e.tip.fPassword?s("el-alert",{attrs:{title:"密码不一致",type:"error",closable:!1}}):e._e(),e._v(" "),2==e.tip.fPassword?s("el-alert",{attrs:{title:"密码不能为空",type:"error",closable:!1}}):e._e()],1),e._v(" "),s("label",{attrs:{for:"rSPassword"}},[e._v("确认密码:")]),e._v(" "),s("el-input",{attrs:{id:"rSPassword",type:"password"},on:{blur:e.checkSPassword},model:{value:e.registerParams.sPassword,callback:function(t){e.$set(e.registerParams,"sPassword",t)},expression:"registerParams.sPassword"}}),e._v(" "),s("div",{staticClass:"alerts"},[1==e.tip.sPassword?s("el-alert",{attrs:{title:"密码不一致",type:"error",closable:!1}}):e._e(),e._v(" "),2==e.tip.sPassword?s("el-alert",{attrs:{title:"密码不能为空",type:"error",closable:!1}}):e._e()],1),e._v(" "),s("label",{attrs:{for:"email"}},[e._v("邮箱:")]),e._v(" "),s("el-input",{attrs:{id:"email",type:"text"},on:{blur:e.checkEmail},model:{value:e.registerParams.email,callback:function(t){e.$set(e.registerParams,"email",t)},expression:"registerParams.email"}}),e._v(" "),s("div",{staticClass:"alerts"},[1==e.tip.email?s("el-alert",{attrs:{title:"邮箱格式不正确",type:"error",closable:!1}}):e._e(),e._v(" "),2==e.tip.email?s("el-alert",{attrs:{title:"邮箱不能为空",type:"error",closable:!1}}):e._e()],1),e._v(" "),s("div",{staticClass:"button-group"},[s("el-button",{attrs:{type:"primary"},on:{click:e.register}},[e._v("注册")]),e._v(" "),s("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){e.isRegister=!1}}},[e._v("返回")])],1)],1)])])},staticRenderFns:[]};var $=s("VU/8")(P,F,!1,function(e){s("WGRq")},null,null).exports,C=s("//Fk"),G=s.n(C),x=s("Xxa5"),N=s.n(x),D=s("exGp"),T=s.n(D),U={name:"aMessage",props:["name","isAtRight","expressArr","data"],data:function(){return{message:"",file:{name:"",path:"",iconPath:""}}},computed:{},mounted:function(){if(4===this.data.messageType){var e=this.data.filePath.split("/");this.file.name=e[e.length-1],this.file.path="http://"+this.$store.state.statisFileIp+this.data.filePath,this.file.iconPath="http://"+this.$store.state.statisFileIp+"/file/baseIcon/file1.jpg"}},methods:{download:function(){window.open(this.file.path,"_blank")}},components:{headPortrait:d}},M={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{aMessage:!0,atRight:e.isAtRight}},[s("headPortrait",{class:{fl:!e.isAtRight,fr:e.isAtRight},attrs:{isSave:!0,userId:e.data.senderId}}),e._v(" "),s("div",{class:{fl:!e.isAtRight,fr:e.isAtRight}},[s("span",{attrs:{id:"name"}},[e._v(e._s(e.name))]),e._v(" "),4!==e.data.messageType?s("div",{domProps:{innerHTML:e._s(e.data.message)}}):e._e(),e._v(" "),4===e.data.messageType?s("div",{staticClass:"file-wrap"},[s("img",{attrs:{src:e.file.iconPath,alt:""}}),e._v(" "),s("div",[s("p",[e._v(e._s(e.file.name))]),e._v(" "),s("a",{on:{click:e.download}},[e._v("下载")])])]):e._e()])],1)},staticRenderFns:[]};var R=s("VU/8")(U,M,!1,function(e){s("mjfy")},null,null).exports,A=s("mvHQ"),L=s.n(A),E={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:e.openTitle,"before-close":e.confirmClose,visible:e.dialogFlag,"close-on-click-modal":!1},on:{close:e.close,"update:visible":function(t){e.dialogFlag=t},open:e.open}},[e._t("dialogContent"),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.tip?s("div",{staticClass:"tip"},[e._v(e._s(e.tip))]):e._e(),e._v(" "),e._t("footerButton"),e._v(" "),!1!==e.isDefaultBtn?s("div",[s("el-button",{attrs:{disabled:e.isSaveLoading,loading:e.isSaveLoading,type:"primary"},on:{click:e.save}},[e._v("保存")]),e._v(" "),s("el-button",{on:{click:e.close}},[e._v("取 消")])],1):e._e()],2)],2)},staticRenderFns:[]};var S=s("VU/8")({name:"dialogs",props:["dialogFlag","openTitle","tip","openData","isDefaultBtn","isBeforeClose","isSaveLoading"],methods:{confirmClose:function(e){!0!==this.isBeforeClose?e():this.$emit("confirmClose")},save:function(){this.$emit("save")},close:function(){this.$emit("update:dialogFlag",!1),this.$emit("close")},open:function(){this.$emit("open")}}},E,!1,function(e){s("sVCO")},null,null).exports,B={name:"groupManageDialog",props:["dialogFlag","openData"],data:function(){return{groupArr:[]}},computed:{},methods:{deleteGroup:function(e){var t=this;this.$http.post("/deleteGroup.do",{groupId:this.groupArr[e].value}).then(function(s){s.data.success&&(t.groupArr.splice(e,1),t.refresh())})},addGroup:function(){var e=this;this.$prompt("请输入组名","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(t){var s=t.value;e.$http.post("/addGroup.do",{groupName:s,userId:e.$store.state.userId}).then(function(t){t.data.success&&(e.groupArr.push({name:s,value:t.data.insertId}),e.refresh())})})},refresh:function(){var e=this;T()(N.a.mark(function t(){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$parent.getFriendGroup();case 2:return t.next=4,e.$parent.getFriend();case 4:case"end":return t.stop()}},t,e)}))()},open:function(){this.groupArr=JSON.parse(L()(this.openData))},close:function(){this.$emit("update:dialogFlag",!1)}},components:{dialogs:S}},j={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"groupManageDialog"},[s("dialogs",{attrs:{dialogFlag:e.dialogFlag,openTitle:"分组管理",isDefaultBtn:!1},on:{"update:dialogFlag":function(t){e.dialogFlag=t},close:e.close,open:e.open}},[s("div",{attrs:{slot:"dialogContent"},slot:"dialogContent"},[s("div",{staticClass:"button-field"},[s("i",{staticClass:"fa fa-plus-circle"}),s("span",{on:{click:e.addGroup}},[e._v("添加分组")])]),e._v(" "),s("div",{staticClass:"content"},e._l(e.groupArr,function(t,a){return s("div",{key:a,staticClass:"group"},[s("span",[e._v(e._s(t.name))]),e._v(" "),s("el-button",{staticClass:"fr",attrs:{type:"danger",disabled:"我的好友"===t.name},on:{click:function(t){e.deleteGroup(a)}}},[e._v("删除")])],1)}))]),e._v(" "),s("div",{attrs:{slot:"footerButton"},slot:"footerButton"},[s("el-button",{attrs:{type:"primary"},on:{click:e.close}},[e._v("完成")])],1)])],1)},staticRenderFns:[]};var V={name:"addFriendDialog",props:["dialogFlag","friendList"],data:function(){return{checkedIndex:"",searchList:[],postParams:""}},methods:{addFriend:function(e){var t=this,s={userId:sessionStorage.getItem("userId"),friendId:this.searchList[e].userId,friendPolicyType:this.searchList[e].friendPolicyType};if(0===this.searchList[e].friendPolicyType)this.$http.post("/addFriend.do",s).then(function(e){e.data.success&&("添加成功"===e.data.msg?(t.$message({message:e.data.msg,type:"success"}),t.$emit("update:dialogFlag",!1),T()(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$parent.getFriendGroup();case 2:return e.next=4,t.$parent.getFriend();case 4:case"end":return e.stop()}},e,t)}))()):t.$message.error(e.data.msg))});else{var a=1===this.searchList[e].friendPolicyType?"请输入验证密码":this.searchList[e].friendPolicyQuestion;this.$prompt(a,"好友验证",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){var r=a.value;["",null].includes(r)?t.$message.error("输入不能为空"):(1===t.searchList[e].friendPolicyType?s.friendPolicyPassword=r:(s.friendPolicyAnswer=r,s.remark=t.searchList[e].friendPolicyQuestion),t.$http.post("/checkFriendRequest.do",s).then(function(e){e.data.success&&("验证成功"===e.data.msg?t.$http.post("/addFriend.do",s).then(function(e){e.data.success&&("添加成功"===e.data.msg?(t.$message({message:e.data.msg,type:"success"}),t.$emit("update:dialogFlag",!1),T()(N.a.mark(function e(){return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$parent.getFriendGroup();case 2:return e.next=4,t.$parent.getFriend();case 4:case"end":return e.stop()}},e,t)}))()):t.$message.error(e.data.msg))}):"好友请求已发送"===e.data.msg?t.$message({message:e.data.msg,type:"success"}):t.$message.error(e.data.msg))}))}).catch(function(){})}},search:function(){var e=this;""!==this.postParams?this.$http.post("/searchUserFuzzily.do",{idOrName:this.postParams}).then(function(t){if(t.data.success){var s=[];0!==t.data.data.length&&t.data.data.forEach(function(t){t.U_LoginID!==e.$store.state.userId&&s.push({userId:t.U_LoginID,nickName:t.U_NickName,age:t.U_Age,phone:t.U_Telephone,name:t.U_Name,friendPolicyType:t.U_FriendshipPolicyID,friendPolicyQuestion:t.U_FriendPolicyQuestion})}),e.searchList=s}}):this.$message.error("输入不能为空")},close:function(){this.$emit("update:dialogFlag",!1)}},components:{dialogs:S}},z={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"addFriendDialog"},[a("dialogs",{attrs:{dialogFlag:e.dialogFlag,openTitle:"添加好友",isDefaultBtn:!1},on:{"update:dialogFlag":function(t){e.dialogFlag=t},close:e.close}},[a("div",{attrs:{slot:"dialogContent"},slot:"dialogContent"},[a("div",{staticClass:"search"},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入对方账号或昵称"},model:{value:e.postParams,callback:function(t){e.postParams=t},expression:"postParams"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)],1),e._v(" "),a("div",{staticClass:"search-result"},e._l(e.searchList,function(t,r){return a("div",{key:r,staticClass:"user clearfix",class:{checked:e.checkedIndex===r},on:{click:function(t){e.checkedIndex=r}}},[a("img",{staticClass:"fl",attrs:{src:s("EVuS"),alt:""}}),e._v(" "),a("div",{staticClass:"base-data fl"},[a("span",[e._v("ID:"+e._s(t.userId))]),e._v(" "),["",null].includes(t.nickName)?e._e():a("span",[e._v("昵称:"+e._s(t.nickName))]),e._v(" "),["",null].includes(t.age)?e._e():a("span",[e._v("年龄:"+e._s(t.age))]),e._v(" "),["",null].includes(t.phone)?e._e():a("span",[e._v("手机:"+e._s(t.phone))]),e._v(" "),["",null].includes(t.name)?e._e():a("span",[e._v("真实姓名:"+e._s(t.name))])]),e._v(" "),a("div",{staticClass:"operate fr"},[a("el-button",{attrs:{type:"primary",disabled:e.friendList.some(function(e){return e.friendId==t.userId})},on:{click:function(t){e.addFriend(r)}}},[e._v(e._s(0!==e.friendList.filter(function(e){return e.friendId==t.userId}).length?e.friendList.filter(function(e){return e.friendId==t.userId})[0].type?"申请中":"已是好友":"添加好友"))])],1)])}))])])],1)},staticRenderFns:[]};var Z={name:"myFriend",data:function(){return{curFriend:{},selectedOptions:[],options:[{label:"修改备注",value:"1"},{label:"移至分组",value:"2"},{label:"删除好友",value:"3"}],friendList:[],addFlag:!1,groupFlag:!1,friendGroup:[],message:"",curGroupId:"",curFriendId:"",messageRecord:[],expressArr:[],isLoadingImage:!0}},computed:{socket:function(){return this.$store.state.socket}},mounted:function(){var e=this;T()(N.a.mark(function t(){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getFriendGroup();case 2:return t.next=4,e.getFriend();case 4:case"end":return t.stop()}},t,e)}))(),this.getExpress(!1)},methods:{beforeFileUpload:function(e){var t=e.size/1024/1024<100;return!t&&this.$message.error("文件不能超过100Mb"),t},fileUpdateSuccess:function(e,t){var s=this;this.messageRecord.push({senderId:this.$store.state.userId,name:this.$store.state.nickName||this.$store.state.userId,filePath:e.data.filePath,isAtRight:!0,messageType:4}),this.socket.emit("remandFriend",{from:e.data.from,friendName:this.curFriend.nickName,filePath:e.data.filePath,to:e.data.to,messageType:4}),this.$refs.uploadFile.clearFiles(),this.$nextTick(function(){k(s.$refs.message.$el)})},beforePicUpload:function(e){var t=e.name.split("."),s=t[t.length-1].toLowerCase(),a=e.size/1024/1024<10,r=/mov|avi|flv|mp4|rmvb|mkv|jpeg|jpg|png|gif/i.test(s);return!a&&this.$message.error("文件不能超过10Mb"),!r&&this.$message.error("不识别此格式文件"),r&&a},picUpdateSuccess:function(e,t){var s=this,a=t.name.split("."),r=a[a.length-1].toLowerCase();/mov|avi|flv|mp4|rmvb|mkv/i.test(r)?(this.messageRecord.push({senderId:this.$store.state.userId,name:this.$store.state.nickName||this.$store.state.userId,message:'<video src="'+t.url+'" autoplay loop controls></video>',isAtRight:!0,messageType:3}),this.socket.emit("remandFriend",{message:'<video src="http://'+(this.$store.state.statisFileIp+e.data.filePath)+'" autoplay loop controls></video>',from:e.data.from,friendName:this.curFriend.nickName,to:e.data.to,messageType:3})):/jpeg|jpg|png|gif/i.test(r)&&(this.messageRecord.push({senderId:this.$store.state.userId,name:this.$store.state.nickName||this.$store.state.userId,message:"<img src='"+t.url+"'></img>",isAtRight:!0,messageType:3}),this.socket.emit("remandFriend",{message:'<img src="http://'+(this.$store.state.statisFileIp+e.data.filePath)+'"></img>',from:e.data.from,friendName:this.curFriend.nickName,to:e.data.to,messageType:3})),this.$refs.uploadPic.clearFiles(),this.$nextTick(function(){k(s.$refs.message.$el)})},videoRequest:function(){var e=this,t=this.friendGroup.filter(function(t){return t.value==e.curGroupId})[0].content.filter(function(t){return t.friendId==e.curFriendId})[0];this.socket.emit("videoRequest",{to:{id:this.curFriendId,name:t.remark||t.nickName||t.friendId},from:{id:sessionStorage.getItem("userId"),name:this.$store.state.nickName||this.$store.state.userId}}),this.$message({message:"已发送视频通话请求",type:"success"})},handleChange:function(e,t){var s=this;if(""!=this.selectedOptions){"1"===this.selectedOptions[0]?this.$prompt(" ","修改备注",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){var r=a.value;T()(N.a.mark(function a(){return N.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.reviseRemark(s.friendGroup[e].content[t].friendId,r);case 2:s.getFriend();case 3:case"end":return a.stop()}},a,s)}))()}):"2"===this.selectedOptions[0]?T()(N.a.mark(function a(){return N.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.changeGroup(s.friendGroup[e].content[t].friendId,s.selectedOptions[1]);case 2:s.getFriend();case 3:case"end":return a.stop()}},a,s)}))():T()(N.a.mark(function a(){return N.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,s.deleteFriend(s.friendGroup[e].content[t].friendId);case 2:s.getFriend();case 3:case"end":return a.stop()}},a,s)}))();var a={stopPropagation:function(){}};this.$refs["friendMenu"+e+"-"+t][0].clearValue(a)}},clickExpress:function(e){this.message+="{"+this.expressArr[e].split(".")[0]+"}"},getExpress:function(e){var t=this;(e||0===this.expressArr.length)&&(this.isLoadingImage=!0,this.$http.post("/getExpress.do",{userId:this.$store.state.userId}).then(function(e){e.data.success&&(t.expressArr=e.data.data,t.isLoadingImage=!1)}))},deleteFriend:function(e){var t=this;return new G.a(function(s){t.$http.post("/deleteFriend.do",{userId:sessionStorage.getItem("userId"),friendId:e}).then(function(e){e.data.success&&(t.$message({message:"删除成功",type:"success"}),s())})})},changeGroup:function(e,t){var s=this;return new G.a(function(a){s.$http.post("/changeGroup.do",{userId:sessionStorage.getItem("userId"),friendId:e,friendGroupsId:t}).then(function(e){e.data.success&&(s.$message({message:'已移至"'+s.friendGroup.filter(function(e){return e.value===t})[0].name+'"',type:"success"}),a())})})},reviseRemark:function(e,t){var s=this;return new G.a(function(a){s.$http.post("/reviseRemark.do",{userId:sessionStorage.getItem("userId"),friendId:e,name:t}).then(function(e){e.data.success&&(s.$message({message:"修改成功",type:"success"}),a())})})},handleOpen:function(){},handleClose:function(){},openGroupManageDialog:function(){this.groupFlag=!0},openAddFriendDialog:function(){this.addFlag=!0},openGroupMenu:function(e){e.button},sendMessage:function(){var e=this;if(""!==this.message){var t={messageType:1,message:this.message,from:sessionStorage.getItem("userId"),to:this.curFriendId},s=this.message.match(/\{[0-9a-zA-Z]+(\-\g+){0,1}\}/gi);s&&s.forEach(function(s,a){var r=s.split("}")[0].split("{")[1];e.expressArr.some(function(e){return e.split(".")[0]==r})&&(t.messageType=2,t.expressName?t.expressName+=","+r:(t.expressName="",t.expressName+=r))}),this.$http.post("/sendMessage.do",t).then(function(s){s.data.success&&(e.$message({message:"发送成功",type:"success"}),e.messageRecord.push({senderId:e.$store.state.userId,name:e.$store.state.nickName||e.$store.state.userId,message:_(2,e.message,e.expressArr.filter(function(t){return I(e.message).includes(t.split(".")[0])}),e.$store.state.statisFileIp),isAtRight:!0}),e.$nextTick(function(){k(e.$refs.message.$el)}),e.$store.state.socket.emit("remandFriend",{message:_(2,e.message,e.expressArr.filter(function(t){return I(e.message).includes(t.split(".")[0])}),e.$store.state.statisFileIp),from:sessionStorage.getItem("userId"),to:e.curFriendId,friendName:e.curFriend.nickName,messageType:t.messageType}),e.message="")})}},select:function(e,t){var s=this;console.log(this.curFriendId),this.curFriendId!=e&&(this.curFriendId=e,this.curFriend=this.friendList.filter(function(e){return e.friendId===s.curFriendId})[0],this.curGroupId=t[0],this.getFriendMessage(e,t))},getFriendMessage:function(e,t){var s=this;this.messageRecord=[],this.$http.post("/getFriendMessage.do",{userId:sessionStorage.getItem("userId"),friendId:e}).then(function(a){a.data.success&&(0!==a.data.data.length&&a.data.data.forEach(function(a){var r=void 0,i=a.M_PostMessages;if(a.M_FromUserID===e&&(r=s.friendGroup.filter(function(e){return e.value==t[0]})[0].content.filter(function(t){return t.friendId==e})[0]),[3,4].includes(a.M_MessageTypeID)){var o=a.M_FilePath.split("."),n=o[o.length-1].toLowerCase();/mov|avi|flv|mp4|rmvb|mkv/i.test(n)?s.messageRecord.push({message:'<video src="http://'+(s.$store.state.statisFileIp+a.M_FilePath)+'" autoplay loop controls></video>',senderId:a.M_FromUserID,name:a.M_FromUserID!==e?s.$store.state.nickName||s.$store.state.userId:r.remark||r.nickName||r.friendId,isAtRight:a.M_FromUserID!==e,messageType:a.M_MessageTypeID,filePath:a.M_FilePath}):/jpeg|jpg|png|gif/i.test(n)?s.messageRecord.push({message:"<img src='http://"+(s.$store.state.statisFileIp+a.M_FilePath)+"'></img>",senderId:a.M_FromUserID,name:a.M_FromUserID!==e?s.$store.state.nickName||s.$store.state.userId:r.remark||r.nickName||r.friendId,isAtRight:a.M_FromUserID!==e,messageType:a.M_MessageTypeID,filePath:a.M_FilePath}):s.messageRecord.push({message:a.M_PostMessages,senderId:a.M_FromUserID,name:a.M_FromUserID!==e?s.$store.state.nickName||s.$store.state.userId:r.remark||r.nickName||r.friendId,isAtRight:a.M_FromUserID!==e,messageType:a.M_MessageTypeID,filePath:a.M_FilePath})}else[1,2].includes(a.M_MessageTypeID)&&(a.expressArr&&(i=_(1,i,a.expressArr)),s.messageRecord.push({senderId:a.M_FromUserID,name:a.M_FromUserID!==e?s.$store.state.nickName||s.$store.state.userId:r.remark||r.nickName||r.friendId,message:i,isAtRight:a.M_FromUserID!==e,messageType:a.M_MessageTypeID,filePath:a.M_FilePath}))}),s.$nextTick(function(){k(s.$refs.message.$el)}))})},getFriend:function(){var e=this;return new G.a(function(t){e.friendList=[],e.$http.post("/getFriend.do",{userId:sessionStorage.getItem("userId")}).then(function(s){s.data.success&&(e.friendGroup.forEach(function(t,s){e.friendGroup[s].content=[]}),s.data.data.forEach(function(t){e.friendGroup.forEach(function(s,a){s.value==t.F_FriendGroupsID&&(e.friendList.push({remark:t.F_Name,nickName:t.U_NickName,friendId:t.F_FriendID}),e.friendGroup[a].content.push({remark:t.F_Name,nickName:t.U_NickName,friendId:t.F_FriendID}))})}),t())}),e.$http.post("/getYourFriendRequest.do",{userId:sessionStorage.getItem("userId")}).then(function(s){s.data.success&&(s.data.data.forEach(function(t,s){e.friendList.push({remark:t.F_Name,nickName:t.U_NickName,friendId:t.UM_ToID,type:1})}),t())})})},getFriendGroup:function(){var e=this;return new G.a(function(t){e.$http.post("/getFriendGroup.do",{userId:sessionStorage.getItem("userId")}).then(function(s){if(s.data.success){var a=[];e.options[1].children=[],s.data.data.forEach(function(t,s){e.options[1].children.push({label:t.FG_Name,value:t.FG_ID}),a.push({name:t.FG_Name,value:t.FG_ID,content:[]})}),e.friendGroup=a,t()}})})}},watch:{socket:{handler:function(e){var t=this;e&&(this.$store.state.socket.removeAllListeners("getMessage"),this.$store.state.socket.on("getMessage",function(e){if(void 0===e.groupId&&(t.$notify({title:"好友消息",dangerouslyUseHTMLString:!0,message:"<p>"+(e.friendName||e.from)+':</p><div style="text-indent:2em;">'+(3===e.messageType?"[图像]":4===e.messageType?"[文件]":e.message)+"</div> ",duration:5e3}),e.from===t.curFriendId)){var s=t.friendGroup.filter(function(e){return e.value==t.curGroupId})[0].content.filter(function(e){return e.friendId==t.curFriendId})[0];t.messageRecord.push({senderId:e.from,name:s.remark||s.nickName||s.friendId,message:e.message,isAtRight:!1,filePath:e.filePath,messageType:e.messageType}),t.$nextTick(function(){k(t.$refs.message.$el)})}}))},deep:!0}},components:{aMessage:R,groupManageDialog:s("VU/8")(B,j,!1,function(e){s("UIj/")},null,null).exports,addFriendDialog:s("VU/8")(V,z,!1,function(e){s("uLvx")},null,null).exports,headPortrait:d}},O={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"myFriend",on:{mousedown:e.openGroupMenu}},[s("groupManageDialog",{attrs:{dialogFlag:e.groupFlag,openData:e.friendGroup},on:{"update:dialogFlag":function(t){e.groupFlag=t}}}),e._v(" "),s("addFriendDialog",{attrs:{dialogFlag:e.addFlag,friendList:e.friendList},on:{"update:dialogFlag":function(t){e.addFlag=t}}}),e._v(" "),s("el-container",[s("el-aside",{attrs:{width:"200px"}},[s("div",{staticClass:"operate"},[s("i",{staticClass:"el-icon-plus fr",on:{click:e.openAddFriendDialog}}),e._v(" "),s("i",{staticClass:"fa fa-bars fr",on:{click:e.openGroupManageDialog}})]),e._v(" "),s("div",{staticClass:"search-wrap"},[s("el-input",{attrs:{placeholder:"请输入好友账号或昵称"}})],1),e._v(" "),s("div",{staticClass:"my-group"},[s("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.select,open:e.handleOpen,close:e.handleClose}},e._l(e.friendGroup,function(t,a){return s("el-submenu",{key:t.value,attrs:{index:t.value+""}},[s("template",{slot:"title"},[s("span",[e._v(e._s(t.name))])]),e._v(" "),e._l(t.content,function(t,r){return s("el-menu-item",{key:t.friendId,attrs:{index:t.friendId}},[s("div",[s("headPortrait",{attrs:{userId:t.friendId}}),e._v("\n                "+e._s(t.remark||t.nickName||t.friendId)+"\n                "),s("div",{staticClass:"cascader",on:{click:function(e){e.stopPropagation()}}},[s("el-cascader",{ref:"friendMenu"+a+"-"+r,refInFor:!0,attrs:{options:e.options},on:{change:function(t){e.handleChange(a,r)}},model:{value:e.selectedOptions,callback:function(t){e.selectedOptions=t},expression:"selectedOptions"}})],1)],1)])})],2)}))],1)]),e._v(" "),s("el-container",[s("el-main",{ref:"message",class:{small:this.$store.state.isVideo}},[""!==this.curFriendId?s("div",{staticClass:"messageField"},e._l(e.messageRecord,function(t,a){return s("aMessage",{key:a,attrs:{name:t.name,isAtRight:t.isAtRight,expressArr:e.expressArr,data:t}})})):e._e()]),e._v(" "),s("el-footer",[""!==this.curFriendId?s("div",{staticClass:"inputField"},[s("div",{staticClass:"input-menu"},[s("i",{staticClass:"fa fa-font",attrs:{title:"文字样式"}}),e._v(" "),s("el-popover",{ref:"express",attrs:{"popper-class":"express-popover",placement:"top-start",trigger:"click"}},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoadingImage,expression:"isLoadingImage"}]},e._l(e.expressArr,function(t,a){return s("img",{key:t,ref:t.split(".")[0],refInFor:!0,attrs:{src:"http://"+e.$store.state.statisFileIp+"/express/"+t,alt:""},on:{click:function(t){e.clickExpress(a)}}})}))]),e._v(" "),s("i",{directives:[{name:"popover",rawName:"v-popover:express",arg:"express"}],staticClass:"fa fa-smile-o",attrs:{title:"表情"},on:{click:function(t){e.getExpress(!1)}}}),e._v(" "),s("span",{staticClass:"upload-wrap",attrs:{title:"发送图片或视频"}},[s("el-upload",{ref:"uploadPic",attrs:{action:"/uploadPicture.do?userId="+e.$store.state.userId+"&&friendId="+e.curFriendId,"on-success":e.picUpdateSuccess,"before-upload":e.beforePicUpload,limit:1}},[s("i",{staticClass:"el-icon-picture"})])],1),e._v(" "),s("i",{staticClass:"fa  fa-video-camera",attrs:{title:"视频通话"},on:{click:e.videoRequest}}),e._v(" "),s("span",{staticClass:"upload-wrap",attrs:{title:"发送文件"}},[s("el-upload",{ref:"uploadFile",attrs:{action:"/uploadFile.do?userId="+e.$store.state.userId+"&&friendId="+e.curFriendId,"on-success":e.fileUpdateSuccess,"before-upload":e.beforeFileUpload,limit:1}},[s("i",{staticClass:"el-icon-tickets"})])],1)],1),e._v(" "),s("div",{staticClass:"input-wrap"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],domProps:{value:e.message},on:{input:function(t){t.target.composing||(e.message=t.target.value)}}}),e._v(" "),s("button",{staticClass:"send-button",on:{click:e.sendMessage}},[e._v("发送")])])]):e._e()])],1)],1)],1)},staticRenderFns:[]};var H=s("VU/8")(Z,O,!1,function(e){s("b3kr")},null,null).exports,W={name:"createGroupDialog",props:["dialogFlag"],data:function(){return{imageUrl:"",fileList:[],groupName:"",groupId:"",groupIdTip:0,groupNameTip:0}},mounted:function(){},methods:{open:function(){this.fileList=[],this.groupName="",this.groupId="",this.groupNameTip="",this.groupIdTip="",this.imageUrl=""},translateGroupIdTip:function(e){switch(e){case 1:return"输入不能为空";case 2:return"可以使用";case 3:return"该ID以被注册";default:return null}},checkGroupName:function(){""===this.groupName?this.groupNameTip=1:this.groupNameTip=0},checkGroupId:function(){var e=this;""!==this.groupId?this.$http.post("/checkGroupId.do",{groupId:this.groupId}).then(function(t){t.data.success?e.groupIdTip=2:e.groupIdTip=3}):this.groupIdTip=1},createGroup:function(){var e=!1;2!==this.groupIdTip&&(0===this.groupIdTip&&(this.groupIdTip=1),e=!0),""===this.groupName&&(this.groupNameTip=1,e=!0),0!==this.fileList.length?!e&&this.$refs.uploadGroupIcon.submit():this.$message.error("请设置群图标")},change:function(e,t){var s=e.name.split("."),a=s[s.length-1].toLowerCase(),r=e.size/1024/1024<2,i=/jpeg|jpg|png|gif/i.test(a);!r&&this.$message.error("图片不能超过2Mb"),!i&&this.$message.error("不识别此格式文件"),r&&i?(this.fileList=[t[t.length-1]],this.imageUrl=URL.createObjectURL(e.raw)):this.fileList=[t[0]]},onUploading:function(e,t,s){console.log(e),console.log(t),console.log(s)},handleAvatarSuccess:function(e,t){var s=this;e.success&&this.$http.post("/createGroup.do",{groupId:this.groupId,groupName:this.groupName,userId:this.$store.state.userId,icon:e.data}).then(function(e){e.data.success&&(s.$message({message:"创建群成功",type:"success"}),s.$emit("update:dialogFlag",!1),s.$parent.getAllGroups())})},beforeAvatarUpload:function(e){console.log(e);var t=e.name.split("."),s=t[t.length-1].toLowerCase(),a=e.size/1024/1024<2,r=/jpeg|jpg|png|gif/i.test(s);return!a&&this.$message.error("图片不能超过2Mb"),!r&&this.$message.error("不识别此格式文件"),r&&a},close:function(){this.$emit("update:dialogFlag",!1)}},components:{dialogs:S}},Q={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"createGroupDialog"},[s("dialogs",{attrs:{dialogFlag:e.dialogFlag,openTitle:"创建群",isDefaultBtn:!1},on:{"update:dialogFlag":function(t){e.dialogFlag=t},close:e.close,open:e.open}},[s("div",{attrs:{slot:"dialogContent"},slot:"dialogContent"},[s("div",{staticClass:"upload-wrap"},[s("el-upload",{ref:"uploadGroupIcon",staticClass:"avatar-uploader",attrs:{"auto-upload":!1,"show-file-list":!1,data:{groupId:e.groupId,groupName:e.groupName,userId:e.$store.state.userId},action:"/uploadGroupIcon.do?groupId="+e.groupId,"file-list":e.fileList,"on-change":e.change,"on-progress":e.onUploading,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.imageUrl?s("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),s("div",{staticClass:"input-group"},[s("el-row",[s("el-input",{attrs:{placeholder:"请写群ID"},on:{blur:e.checkGroupId},model:{value:e.groupId,callback:function(t){e.groupId=t},expression:"groupId"}}),e._v(" "),s("span",{class:{groupTip:!0,isError:[1,3].includes(e.groupIdTip)}},[e._v(e._s(e.translateGroupIdTip(e.groupIdTip)))])],1),e._v(" "),s("el-row",[s("el-input",{attrs:{placeholder:"请写群名称"},on:{blur:e.checkGroupName},model:{value:e.groupName,callback:function(t){e.groupName=t},expression:"groupName"}}),e._v(" "),s("span",{class:{groupTip:!0,isError:[1,3].includes(e.groupNameTip)}},[e._v(e._s(e.translateGroupIdTip(e.groupNameTip)))])],1),e._v(" "),s("el-row",[s("el-button",{attrs:{type:"primary"},on:{click:e.createGroup}},[e._v("创建")])],1)],1)])])],1)},staticRenderFns:[]};var Y={name:"groupDetailDialog",props:["dialogFlag","openData"],data:function(){return{fileList:[],imageUrl:"",params:{groupNick:"",groupIntro:"",groupName:""},friendGroup:[]}},methods:{open:function(){var e=this;this.fileList=[{name:"icon",url:"http://"+this.$store.state.statisFileIp+this.openData.icon}],this.imageUrl="http://"+this.$store.state.statisFileIp+this.openData.icon,this.params.groupNick=this.openData.members.filter(function(t){return t.memberId===e.$store.state.userId})[0].groupNick||this.$store.state.nickName||this.$store.state.userId,this.params.groupIntro=this.openData.groupIntro,this.params.groupName=this.openData.groupName},saveGroupDetail:function(){var e=this;""!==this.params.groupNick?this.$http.post("/saveGroupDetail.do",{userId:this.$store.state.userId,groupId:this.openData.groupId,groupName:this.params.groupName,groupNick:this.params.groupNick,groupIntro:this.params.groupIntro}).then(function(t){t.data.success&&(e.$message({message:"保存成功",type:"success"}),e.$parent.getAllGroups(),e.$emit("update:dialogFlag",!1))}):this.$message.error("群片名不能为空")},select:function(e,t){var s=this,a=this.openData;delete a.members,this.$http.post("/inviteGroup.do",{toId:e,fromId:this.$store.state.userId,remark:a}).then(function(e){e.data.success&&s.$message({message:"已发送邀请",type:"success"})})},handleChange:function(){},getFriend:function(){var e=this;return new G.a(function(t){e.$http.post("/getFriend.do",{userId:sessionStorage.getItem("userId")}).then(function(s){s.data.success&&(e.friendGroup.forEach(function(t,s){e.friendGroup[s].content=[]}),s.data.data.forEach(function(t){e.friendGroup.forEach(function(s,a){s.value==t.F_FriendGroupsID&&e.friendGroup[a].content.push({remark:t.F_Name,nickName:t.U_NickName,friendId:t.F_FriendID})})}),t())})})},getFriendGroup:function(){var e=this;return new G.a(function(t){e.$http.post("/getFriendGroup.do",{userId:e.$store.state.userId}).then(function(s){if(s.data.success){var a=[];s.data.data.forEach(function(e,t){a.push({name:e.FG_Name,value:e.FG_ID,content:[]})}),e.friendGroup=a,t()}})})},show:function(){var e=this;T()(N.a.mark(function t(){return N.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getFriendGroup();case 2:return t.next=4,e.getFriend();case 4:case"end":return t.stop()}},t,e)}))()},change:function(e,t){var s=e.name.split("."),a=s[s.length-1].toLowerCase(),r=e.size/1024/1024<2,i=/jpeg|jpg|png|gif/i.test(a);!r&&this.$message.error("图片不能超过2Mb"),!i&&this.$message.error("不识别此格式文件"),r&&i?(this.fileList=[t[t.length-1]],this.imageUrl=URL.createObjectURL(e.raw),this.$refs.uploadGroupIcon.submit()):this.fileList=[t[0]]},handleAvatarSuccess:function(e,t){e.success&&(this.$message({message:"群头像设置成功",type:"success"}),document.getElementsByClassName("group"+this.openData.groupId)[0].getElementsByTagName("img")[1].src="http://"+this.$store.state.statisFileIp+e.data.replace(/\\/g,"/").split("/data")[1]+"?time="+(new Date).getTime())},close:function(){this.$emit("update:dialogFlag",!1)}},components:{dialogs:S,headPortrait:d}},J={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"groupDetailDialog"},[s("dialogs",{attrs:{dialogFlag:e.dialogFlag,openTitle:"ID:"+e.openData.groupId,isDefaultBtn:!1},on:{"update:dialogFlag":function(t){e.dialogFlag=t},close:e.close,open:e.open}},[s("div",{attrs:{slot:"dialogContent"},slot:"dialogContent"},[s("div",{staticClass:"upload-wrap"},[s("el-upload",{ref:"uploadGroupIcon",staticClass:"avatar-uploader",attrs:{"show-file-list":!1,"auto-upload":!1,action:"/uploadGroupIcon.do?groupId="+e.openData.groupId,"file-list":e.fileList,"on-change":e.change,"on-success":e.handleAvatarSuccess}},[e.imageUrl?s("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),s("div",{staticClass:"group-nick"},[s("el-row",[s("el-col",{attrs:{span:17}},[s("span",[e._v("群名：")])]),e._v(" "),s("el-col",{attrs:{span:7}},[s("el-input",{model:{value:e.params.groupName,callback:function(t){e.$set(e.params,"groupName",t)},expression:"params.groupName"}})],1)],1)],1),e._v(" "),s("div",{staticClass:"group-nick"},[s("el-row",[s("el-col",{attrs:{span:17}},[s("span",[e._v("我的群片名：")])]),e._v(" "),s("el-col",{attrs:{span:7}},[s("el-input",{model:{value:e.params.groupNick,callback:function(t){e.$set(e.params,"groupNick",t)},expression:"params.groupNick"}})],1)],1)],1),e._v(" "),s("el-popover",{ref:"members",attrs:{"popper-class":"members-popover",placement:"right",trigger:"click"}},[s("el-popover",{ref:"friendList",attrs:{"popper-class":"friends-popover",placement:"left",trigger:"click"},on:{show:e.show}},[s("div",{staticClass:"my-group"},[s("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":"2","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.select}},e._l(e.friendGroup,function(t,a){return s("el-submenu",{key:a,attrs:{index:t.value+""}},[s("template",{slot:"title"},[s("span",[e._v(e._s(t.name))])]),e._v(" "),e._l(t.content,function(t,a){return s("el-menu-item",{key:a,attrs:{index:t.friendId}},[s("div",[s("headPortrait",{attrs:{userId:t.friendId}}),e._v("\n                    "+e._s(t.remark||t.nickName||t.friendId)+"\n                  ")],1)])})],2)}))],1)]),e._v(" "),s("div",{directives:[{name:"popover",rawName:"v-popover:friendList",arg:"friendList"}]},[s("i",{staticClass:"el-icon-plus"}),s("span",[e._v("邀请新成员")])]),e._v(" "),s("div",{staticClass:"table-box"},[s("table",e._l(e.openData.members,function(t){return s("tr",{key:t.memberId},[s("td",[s("headPortrait",{attrs:{userId:t.memberId}})],1),e._v(" "),s("td",[e._v(e._s(t.groupNick||t.memberId))]),e._v(" "),s("td",[s("span",[e._v(e._s(1===t.authority?"群主":3===t.authority?"群员":""))])])])}))])],1),e._v(" "),s("div",{directives:[{name:"popover",rawName:"v-popover:members",arg:"members"}],staticClass:"member-wrap"},[s("span",[e._v("群成员")]),e._v(" "),s("i",{staticClass:"el-icon-arrow-right"})]),e._v(" "),s("div",{staticClass:"group-intro"},[s("el-row",[s("el-col",{attrs:{span:24}},[e._v("群介绍：")]),e._v(" "),s("el-col",{attrs:{span:23,offset:1}},[s("p",[e._v("本群创建于"+e._s(new Date(parseInt(e.openData.createTime,10)).toLocaleString().split(" ")[0]))]),e._v(" "),e.$store.state.userId===e.openData.adminId?s("el-input",{attrs:{type:"textarea",placeholder:"请输入群介绍"},model:{value:e.params.groupIntro,callback:function(t){e.$set(e.params,"groupIntro",t)},expression:"params.groupIntro"}}):s("span",[e._v(e._s(e.openData.groupIntro))])],1)],1)],1),e._v(" "),s("div",{staticClass:"button"},[s("el-button",{attrs:{type:"primary"},on:{click:e.saveGroupDetail}},[e._v("保存")])],1)],1)])],1)},staticRenderFns:[]};var X={name:"myGroups",data:function(){return{groupsList:{createGroup:[],joinGroup:[]},selectedOptions:[],options:[{label:"修改备注",value:"1"},{label:"移至分组",value:"2"},{label:"删除好友",value:"3"}],message:"",curGroupId:"",curGroup:{},messageRecord:[],expressArr:[],isLoadingImage:!0,createGroupFlag:!1,groupDetailFlag:!1,groupDetailData:{}}},computed:{socket:function(){return this.$store.state.socket}},mounted:function(){this.getAllGroups(),this.getExpress(!1)},methods:{getGroupDetailData:function(e){return this.$http.post("/getGroupDetailData.do",{groupId:e})},getGroupMembers:function(e){return this.$http.post("/getGroupMembers.do",{groupId:e})},imgClick:function(e){var t=this,s="0"===e[0]?this.groupsList.createGroup[e[1]]:this.groupsList.joinGroup[e[1]];G.a.all([this.getGroupDetailData(s.groupId),this.getGroupMembers(s.groupId)]).then(function(e){console.log(e),e[0].data.success&&e[1].data.success&&(t.groupDetailData={groupId:e[0].data.data[0].UG_ID,groupName:e[0].data.data[0].UG_Name,groupIntro:e[0].data.data[0].UG_Intro,groupNotice:e[0].data.data[0].UG_Notice,icon:e[0].data.data[0].UG_Icon,createTime:e[0].data.data[0].UG_CreateTime,adminId:e[0].data.data[0].UG_AdminID,members:[]},e[1].data.data.forEach(function(e){t.groupDetailData.members.push({groupNick:e.UGU_GroupNick,memberId:e.UGU_UserID,joinTime:e.UGU_CreateTime,authority:e.UGU_Authority})}),t.groupDetailFlag=!0)})},getGroupMessage:function(e,t){var s=this;this.messageRecord=[],this.$http.post("/getGroupMessage.do",{groupId:this.curGroupId}).then(function(e){e.data.success&&(0!==e.data.data.length&&e.data.data.forEach(function(e){var t=e.GM_Message;if([3,4].includes(e.GM_MessageType)){var a=e.GM_FilePath.split("."),r=a[a.length-1].toLowerCase();/mov|avi|flv|mp4|rmvb|mkv/i.test(r)?s.messageRecord.push({message:'<video src="http://'+(s.$store.state.statisFileIp+e.GM_FilePath)+'" autoplay loop controls></video>',senderId:e.GM_FromID,name:e.GM_FromUName,isAtRight:e.GM_FromID===s.$store.state.userId,messageType:e.GM_MessageType,filePath:e.GM_FilePath}):/jpeg|jpg|png|gif/i.test(r)?s.messageRecord.push({message:"<img src='http://"+(s.$store.state.statisFileIp+e.GM_FilePath)+"'></img>",senderId:e.GM_FromID,name:e.GM_FromUName,isAtRight:e.GM_FromID===s.$store.state.userId,messageType:e.GM_MessageType,filePath:e.GM_FilePath}):s.messageRecord.push({message:e.GM_Message,senderId:e.GM_FromID,name:e.GM_FromUName,isAtRight:e.GM_FromID===s.$store.state.userId,messageType:e.GM_MessageType,filePath:e.GM_FilePath})}else[1,2].includes(e.GM_MessageType)&&(e.expressArr&&(t=_(1,t,e.expressArr)),s.messageRecord.push({message:t,senderId:e.GM_FromID,name:e.GM_FromUName,isAtRight:e.GM_FromID===s.$store.state.userId,messageType:e.GM_MessageType,filePath:e.GM_FilePath}))}),s.$nextTick(function(){k(s.$refs.message.$el)}))})},select:function(e,t){var s=this;G.a.all([this.getGroupDetailData(e),this.getGroupMembers(e)]).then(function(a){a[0].data.success&&a[1].data.success&&(s.groupDetailData={groupId:a[0].data.data[0].UG_ID,groupName:a[0].data.data[0].UG_Name,groupIntro:a[0].data.data[0].UG_Intro,groupNotice:a[0].data.data[0].UG_Notice,icon:a[0].data.data[0].UG_Icon,createTime:a[0].data.data[0].UG_CreateTime,adminId:a[0].data.data[0].UG_AdminID,members:[]},a[1].data.data.forEach(function(e){s.groupDetailData.members.push({groupNick:e.UGU_GroupNick,memberId:e.UGU_UserID,joinTime:e.UGU_CreateTime,authority:e.UGU_Authority})}),s.curGroupId=e,s.curGroup=s.groupsList.createGroup.filter(function(e){return e.groupId===s.curGroupId})[0]||s.groupsList.joinGroup.filter(function(e){return e.groupId===s.curGroupId})[0],s.getGroupMessage(e,t))})},beforeFileUpload:function(e){var t=e.size/1024/1024<100;return!t&&this.$message.error("文件不能超过100Mb"),t},fileUpdateSuccess:function(e,t){var s=this;this.messageRecord.push({senderId:this.$store.state.userId,name:this.$store.state.nickName||this.$store.state.userId,filePath:e.data.filePath,isAtRight:!0,messageType:4}),this.socket.emit("remandFriend",{from:e.data.from,filePath:e.data.filePath,groupId:this.curGroupId,groupName:this.curGroup.groupName,uName:e.data.uName,messageType:4}),this.$refs.uploadFile.clearFiles(),this.$nextTick(function(){k(s.$refs.message.$el)})},beforePicUpload:function(e){var t=e.name.split("."),s=t[t.length-1].toLowerCase(),a=e.size/1024/1024<10,r=/mov|avi|flv|mp4|rmvb|mkv|jpeg|jpg|png|gif/i.test(s);return!a&&this.$message.error("文件不能超过10Mb"),!r&&this.$message.error("不识别此格式文件"),r&&a},picUpdateSuccess:function(e,t){var s=this,a=t.name.split("."),r=a[a.length-1].toLowerCase();/mov|avi|flv|mp4|rmvb|mkv/i.test(r)?(this.messageRecord.push({senderId:this.$store.state.userId,name:e.data.uName,message:'<video src="'+t.url+'" autoplay loop controls></video>',isAtRight:!0,messageType:3}),this.socket.emit("remandFriend",{message:'<video src="http://'+(this.$store.state.statisFileIp+e.data.filePath)+'" autoplay loop controls></video>',from:e.data.from,groupId:this.curGroupId,groupName:this.curGroup.groupName,uName:e.data.uName,messageType:3})):/jpeg|jpg|png|gif/i.test(r)&&(this.messageRecord.push({senderId:this.$store.state.userId,name:this.$store.state.nickName||this.$store.state.userId,message:"<img src='"+t.url+"'></img>",isAtRight:!0,messageType:3}),this.socket.emit("remandFriend",{message:'<img src="http://'+(this.$store.state.statisFileIp+e.data.filePath)+'"></img>',from:e.data.from,groupId:this.curGroupId,groupName:this.curGroup.groupName,uName:e.data.uName,messageType:3})),this.$refs.uploadPic.clearFiles(),this.$nextTick(function(){k(s.$refs.message.$el)})},handleChange:function(e){var t={stopPropagation:function(){}};this.$refs["friendMenu"+e][0].clearValue(t)},clickExpress:function(e){this.message+="{"+this.expressArr[e].split(".")[0]+"}"},getExpress:function(e){var t=this;(e||0===this.expressArr.length)&&(this.isLoadingImage=!0,this.$http.post("/getExpress.do",{userId:this.$store.state.userId}).then(function(e){e.data.success&&(t.expressArr=e.data.data,t.isLoadingImage=!1)}))},sendMessage:function(){var e=this;if(""!==this.message){var t=this.groupDetailData.members.filter(function(t){return t.memberId===e.$store.state.userId})[0].groupNick,s={messageType:1,message:this.message,from:this.$store.state.userId,groupId:this.curGroupId,uName:t||this.$store.state.nickName||this.$store.state.userId},a=this.message.match(/\{[0-9a-zA-Z]+(\-\g+){0,1}\}/gi);a&&a.forEach(function(t,a){var r=t.split("}")[0].split("{")[1];e.expressArr.some(function(e){return e.split(".")[0]==r})&&(s.messageType=2,s.expressName?s.expressName+=","+r:(s.expressName="",s.expressName+=r))}),this.$http.post("/sendGroupMessage.do",s).then(function(a){a.data.success&&(e.$message({message:"发送成功",type:"success"}),e.messageRecord.push({senderId:e.$store.state.userId,name:t||e.$store.state.nickName||e.$store.state.userId,message:_(2,e.message,e.expressArr.filter(function(t){return I(e.message).includes(t.split(".")[0])}),e.$store.state.statisFileIp),isAtRight:!0}),e.$nextTick(function(){k(e.$refs.message.$el)}),e.$store.state.socket.emit("remandFriend",{message:_(2,e.message,e.expressArr.filter(function(t){return I(e.message).includes(t.split(".")[0])}),e.$store.state.statisFileIp),from:e.$store.state.userId,groupId:e.curGroupId,groupName:e.curGroup.groupName,uName:s.uName}),e.message="")})}},getAllGroups:function(){var e=this;return new G.a(function(t){e.$http.post("/getAllGroups.do",{userId:sessionStorage.getItem("userId")}).then(function(s){if(s.data.success){var a={createGroup:[],joinGroup:[]};s.data.data.forEach(function(e){e.UG_CreatorID===sessionStorage.getItem("userId")?a.createGroup.push({groupName:e.UG_Name,groupId:e.UGU_GroupID,groupNick:e.UGU_GroupNick,groupIntro:e.UG_Intro,icon:e.UG_Icon,groupCreateTime:e.UG_CreateTime,groupAdminId:e.UG_AdminID,groupCreaterId:e.UG_CreaterID}):a.joinGroup.push({groupName:e.UG_Name,groupId:e.UGU_GroupID,groupNick:e.UGU_GroupNick,groupIntro:e.UG_Intro,icon:e.UG_Icon,groupCreateTime:e.UG_CreateTime,groupAdminId:e.UG_AdminID,groupCreaterId:e.UG_CreaterID})}),e.groupsList=a,console.log(e.groupsList),t()}})})}},watch:{socket:{handler:function(e){var t=this;e&&(this.$store.state.socket.removeAllListeners("getMessage"),this.$store.state.socket.on("getMessage",function(e){void 0!==e.groupId&&(t.$notify({title:"群聊消息:"+e.groupName,dangerouslyUseHTMLString:!0,message:"<p>"+e.uName+':</p><div style="text-indent:2em;">'+(3===e.messageType?"[图像]":4===e.messageType?"[文件]":e.message)+"</div> ",duration:5e3}),e.groupId===t.curGroupId&&(t.messageRecord.push({senderId:e.from,name:e.uName,message:e.message,isAtRight:!1,filePath:e.filePath,messageType:e.messageType}),t.$nextTick(function(){k(t.$refs.message.$el)})))}))},deep:!0}},components:{aMessage:R,headPortrait:d,createGroupDialog:s("VU/8")(W,Q,!1,function(e){s("DWFB")},null,null).exports,groupDetailDialog:s("VU/8")(Y,J,!1,function(e){s("oAad")},null,null).exports}},q={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"myGroups"},[s("createGroupDialog",{attrs:{dialogFlag:e.createGroupFlag},on:{"update:dialogFlag":function(t){e.createGroupFlag=t}}}),e._v(" "),s("groupDetailDialog",{attrs:{dialogFlag:e.groupDetailFlag,openData:e.groupDetailData},on:{"update:dialogFlag":function(t){e.groupDetailFlag=t}}}),e._v(" "),s("el-container",[s("el-aside",{attrs:{width:"200px"}},[s("div",{staticClass:"operate"},[s("i",{staticClass:"el-icon-plus fr",on:{click:function(e){}}}),e._v(" "),s("i",{staticClass:"fa fa-bars fr",on:{click:function(e){}}})]),e._v(" "),s("div",{staticClass:"search-wrap"},[s("el-input",{attrs:{placeholder:"请输入群ID"}})],1),e._v(" "),s("div",{staticClass:"create-group",on:{click:function(t){e.createGroupFlag=!0}}},[s("i",{staticClass:"el-icon-plus"}),e._v(" "),s("span",[e._v("创建群")])]),e._v(" "),s("div",{staticClass:"my-group"},[s("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:e.select}},[s("el-submenu",{attrs:{index:"0"}},[s("template",{slot:"title"},[s("span",[e._v("我创建的群")])]),e._v(" "),e._l(e.groupsList.createGroup,function(t,a){return s("el-menu-item",{key:a,attrs:{index:t.groupId}},[s("div",[s("headPortrait",{class:"group"+t.groupId,attrs:{imgUrl:t.icon,indexPath:["0",a]},on:{imgClick:e.imgClick}}),e._v(" "),s("span",[e._v(e._s(t.groupName))]),e._v(" "),s("div",{staticClass:"cascader",on:{click:function(e){e.stopPropagation()}}},[s("el-cascader",{ref:"group"+a,refInFor:!0,attrs:{options:e.options},on:{change:function(t){e.handleChange("0",a)}},model:{value:e.selectedOptions,callback:function(t){e.selectedOptions=t},expression:"selectedOptions"}})],1)],1)])})],2),e._v(" "),s("el-submenu",{attrs:{index:"1"}},[s("template",{slot:"title"},[s("span",[e._v("我加入的群")])]),e._v(" "),e._l(e.groupsList.joinGroup,function(t,a){return s("el-menu-item",{key:a,attrs:{index:t.groupId}},[s("div",[s("headPortrait",{class:"group"+t.groupId,attrs:{imgUrl:t.icon,indexPath:["1",a]},on:{imgClick:e.imgClick}}),e._v(" "),s("span",[e._v(e._s(t.groupName))]),e._v(" "),s("div",{staticClass:"cascader",on:{click:function(e){e.stopPropagation()}}},[s("el-cascader",{ref:"group"+a,refInFor:!0,attrs:{options:e.options},on:{change:function(t){e.handleChange("1",a)}},model:{value:e.selectedOptions,callback:function(t){e.selectedOptions=t},expression:"selectedOptions"}})],1)],1)])})],2)],1)],1)]),e._v(" "),s("el-container",[s("el-main",{ref:"message",class:{small:e.$store.state.isVideo}},[""!==e.curGroupId?s("div",{staticClass:"messageField"},e._l(e.messageRecord,function(t){return s("aMessage",{key:t.name,attrs:{name:t.name,isAtRight:t.isAtRight,expressArr:e.expressArr,data:t}})})):e._e()]),e._v(" "),s("el-footer",[""!==e.curGroupId?s("div",{staticClass:"inputField"},[s("div",{staticClass:"input-menu"},[s("i",{staticClass:"fa fa-font",attrs:{title:"文字样式"}}),e._v(" "),s("el-popover",{ref:"express",attrs:{"popper-class":"express-popover",placement:"top-start",trigger:"click"}},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoadingImage,expression:"isLoadingImage"}]},e._l(e.expressArr,function(t,a){return s("img",{key:a,ref:t.split(".")[0],refInFor:!0,attrs:{src:"http://"+e.$store.state.statisFileIp+"/express/"+t,alt:""},on:{click:function(t){e.clickExpress(a)}}})}))]),e._v(" "),s("i",{directives:[{name:"popover",rawName:"v-popover:express",arg:"express"}],staticClass:"fa fa-smile-o",attrs:{title:"表情"},on:{click:function(t){e.getExpress(!1)}}}),e._v(" "),s("span",{staticClass:"upload-wrap",attrs:{title:"发送图片或视频"}},[s("el-upload",{ref:"uploadPic",attrs:{action:"/uploadGroupPicture.do?userId="+e.$store.state.userId+"&&groupId="+e.curGroupId+"&&uName="+(e.groupDetailData.members.filter(function(t){return t.memberId===e.$store.state.userId})[0].groupNick||e.$store.state.nickName||e.$store.state.userId),"on-success":e.picUpdateSuccess,"before-upload":e.beforePicUpload,limit:1}},[s("i",{staticClass:"el-icon-picture"})])],1),e._v(" "),s("span",{staticClass:"upload-wrap",attrs:{title:"发送文件"}},[s("el-upload",{ref:"uploadFile",attrs:{action:"/uploadGroupFile.do?userId="+e.$store.state.userId+"&&groupId="+e.curGroupId+"&&uName="+(e.groupDetailData.members.filter(function(t){return t.memberId===e.$store.state.userId})[0].groupNick||e.$store.state.nickName||e.$store.state.userId),"on-success":e.fileUpdateSuccess,"before-upload":e.beforeFileUpload,limit:1}},[s("i",{staticClass:"el-icon-tickets"})])],1)],1),e._v(" "),s("div",{staticClass:"input-wrap"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],domProps:{value:e.message},on:{input:function(t){t.target.composing||(e.message=t.target.value)}}}),e._v(" "),s("button",{staticClass:"send-button",on:{click:e.sendMessage}},[e._v("发送")])])]):e._e()])],1)],1)],1)},staticRenderFns:[]};var K=s("VU/8")(X,q,!1,function(e){s("FP4z")},null,null).exports,ee={props:["value","reg","max","min"],data:function(){return{oldVal:this.value}},methods:{updateValue:function(e){var t=e.value;this.getResult(t)?(this.oldVal=t,t<this.min&&(e.value=this.oldVal=this.min),t>this.max&&(e.value=this.oldVal=this.max)):e.value=this.oldVal,this.$emit("input",this.oldVal)},blur:function(e){this.$emit("blur",e)},keyup:function(e){this.$emit("keyup",e)},getResult:function(e){if(!this.reg)return!0;if(this.reg.constructor==RegExp)return this.reg.test(e);if(this.reg.constructor==Array||this.reg.constructor==Object){for(var t in this.reg)if(!this.reg[t].test(e))return!1;return!0}return!0}}},te={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"el-input"},[s("input",{staticClass:"el-input__inner",attrs:{type:"text"},domProps:{value:e.value},on:{input:function(t){e.updateValue(t.target)},blur:e.blur,keyup:e.keyup}})])},staticRenderFns:[]},se={name:"baseSetting",props:["data"],data:function(){return{userBaseData:{nickName:"",sex:0,birthday:"",age:"",name:"",email:"",phone:""}}},mounted:function(){},methods:{picUpdateSuccess:function(e,t){var s=this;this.$refs.uploadPic.clearFiles(),Array.prototype.forEach.call(this.$root.$el.getElementsByClassName("yourHead"),function(e,t){e.src="http://"+s.$store.state.statisFileIp+"/headProtrait/"+s.$store.state.userId+".jpg?time="+(new Date).getTime()})},getAge:function(e){this.userBaseData.age=e},getPhone:function(e){this.userBaseData.phone=e},save:function(){var e=this;this.$http.post("/updateUserInfo.do",{userId:sessionStorage.getItem("userId"),nickName:this.userBaseData.nickName,sex:this.userBaseData.sex,birthday:["",null].includes(this.userBaseData.birthday)?"":this.userBaseData.birthday.getTime(),age:this.userBaseData.age,name:this.userBaseData.name,email:this.userBaseData.email,phone:this.userBaseData.phone}).then(function(t){t.data.success&&e.$message({message:"个人信息修改成功",type:"success"})})}},watch:{data:{handler:function(e){this.userBaseData={nickName:e.nickName,sex:e.sex,birthday:new Date(parseInt(e.birthday)),age:e.age,name:e.name,email:e.email,phone:e.phone}},deep:!0}},components:{numberValidator:s("VU/8")(ee,te,!1,null,null,null).exports,headPortrait:d}},ae={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"baseSetting"},[s("div",{staticClass:"left"},[s("div",[s("headPortrait",{attrs:{userId:e.$store.state.userId}})],1),e._v(" "),s("el-upload",{ref:"uploadPic",attrs:{action:"/changeHeadPortrait.do?userId="+e.$store.state.userId,"on-success":e.picUpdateSuccess,limit:1}},[s("a",{attrs:{href:"javascript:;"}},[e._v("更换头像")])]),e._v(" "),s("div",[s("p",[e._v("ID:"+e._s(e.$store.state.userId))])])],1),e._v(" "),s("div",{staticClass:"right"},[s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"nickName"}},[e._v("昵称:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-input",{attrs:{id:"nickName"},model:{value:e.userBaseData.nickName,callback:function(t){e.$set(e.userBaseData,"nickName",t)},expression:"userBaseData.nickName"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",[e._v("性别:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-radio",{attrs:{label:"1"},model:{value:e.userBaseData.sex,callback:function(t){e.$set(e.userBaseData,"sex",t)},expression:"userBaseData.sex"}},[e._v("男")]),e._v(" "),s("el-radio",{attrs:{label:"2"},model:{value:e.userBaseData.sex,callback:function(t){e.$set(e.userBaseData,"sex",t)},expression:"userBaseData.sex"}},[e._v("女")])],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"age"}},[e._v("年龄:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("numberValidator",{attrs:{value:e.userBaseData.age,reg:/^\d*$/},on:{input:e.getAge}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"birthday"}},[e._v("生日:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-date-picker",{attrs:{type:"date",placeholder:"选择日期"},model:{value:e.userBaseData.birthday,callback:function(t){e.$set(e.userBaseData,"birthday",t)},expression:"userBaseData.birthday"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"phone"}},[e._v("手机:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("numberValidator",{attrs:{value:e.userBaseData.phone,reg:/^\d*$/},on:{input:e.getPhone}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"name"}},[e._v("真实姓名:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-input",{attrs:{id:"name"},model:{value:e.userBaseData.name,callback:function(t){e.$set(e.userBaseData,"name",t)},expression:"userBaseData.name"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"email"}},[e._v("邮箱:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-input",{attrs:{id:"email"},model:{value:e.userBaseData.email,callback:function(t){e.$set(e.userBaseData,"email",t)},expression:"userBaseData.email"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:10}},[s("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)],1)],1)])},staticRenderFns:[]};var re={name:"changePassword",data:function(){return{oldPassword:"",newPassword:"",confirmPassword:"",oldPasswordTip:"",newPasswordTip:"",confirmPasswordTip:""}},methods:{checkConfirmPassword:function(){""!==this.confirmPassword?""===this.newPassword||this.newPassword===this.confirmPassword?this.confirmPasswordTip="":this.confirmPasswordTip="密码不一致":this.confirmPasswordTip="密码不能为空"},checkNewPassword:function(){""!==this.newPassword?""===this.confirmPassword||this.newPassword===this.confirmPassword?this.newPasswordTip="":this.newPasswordTip="密码不一致":this.newPasswordTip="密码不能为空"},confirm:function(){var e=this;""===this.newPasswordTip&&""===this.confirmPasswordTip&&""!==this.newPassword&&""!==this.confirmPassword&&this.confirmPassword===this.newPassword&&this.$http.post("/changePassword.do",{userId:sessionStorage.getItem("userId"),password:this.oldPassword,newPassword:this.confirmPassword}).then(function(t){t.data.success&&(t.data.msg?e.oldPasswordTip=t.data.msg:(e.oldPasswordTip="",e.oldPassword="",e.newPassword="",e.confirmPassword="",e.$message({message:"密码修改成功",type:"success"})))})}}},ie={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"changePassword"},[s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"old-password"}},[e._v("原密码:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-input",{attrs:{id:"old-password"},model:{value:e.oldPassword,callback:function(t){e.oldPassword=t},expression:"oldPassword"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:6,offset:4}},[""!==e.oldPasswordTip?s("el-alert",{attrs:{title:e.oldPasswordTip,closable:!1,type:"error"}}):e._e()],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"new-password"}},[e._v("新密码:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-input",{attrs:{id:"new-password"},on:{blur:e.checkNewPassword},model:{value:e.newPassword,callback:function(t){e.newPassword=t},expression:"newPassword"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:6,offset:4}},[""!==e.newPasswordTip?s("el-alert",{attrs:{title:e.newPasswordTip,closable:!1,type:"error"}}):e._e()],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",{attrs:{for:"confirm-password"}},[e._v("确认密码:")])]),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-input",{attrs:{id:"confirm-password"},on:{blur:e.checkConfirmPassword},model:{value:e.confirmPassword,callback:function(t){e.confirmPassword=t},expression:"confirmPassword"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:6,offset:4}},[""!==e.confirmPasswordTip?s("el-alert",{attrs:{title:e.confirmPasswordTip,closable:!1,type:"error"}}):e._e()],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:10}},[s("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]};var oe={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"friendPolicy"},[s("el-row",[s("el-col",{attrs:{span:4}},[s("el-tooltip",{attrs:{effect:"dark",content:"设置该策略他人能直接加您为好友",placement:"bottom-start"}},[s("el-radio",{attrs:{label:0},on:{change:e.changeFriendPolicy},model:{value:e.friendPolicyType,callback:function(t){e.friendPolicyType=t},expression:"friendPolicyType"}},[e._v("策略1")])],1)],1),e._v(" "),s("el-col",{attrs:{span:8,offset:1}},[s("p",[e._v("无")])])],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("el-tooltip",{attrs:{effect:"dark",content:"设置该策略他人输入正确密码后可以直接加您为好友",placement:"bottom-start"}},[s("el-radio",{attrs:{label:1},on:{change:e.changeFriendPolicy},model:{value:e.friendPolicyType,callback:function(t){e.friendPolicyType=t},expression:"friendPolicyType"}},[e._v("策略2")])],1)],1),e._v(" "),s("el-col",{attrs:{span:8,offset:1}},[s("label",{attrs:{for:"proving-password"}},[e._v("验证密码:")]),e._v(" "),s("el-input",{attrs:{id:"proving-password"},model:{value:e.provingPassword,callback:function(t){e.provingPassword=t},expression:"provingPassword"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("el-tooltip",{attrs:{effect:"dark",content:"设置该策略他人将根据问题填写答案，你将接收到好友验证选择是否通过",placement:"bottom-start"}},[s("el-radio",{attrs:{label:2},on:{change:e.changeFriendPolicy},model:{value:e.friendPolicyType,callback:function(t){e.friendPolicyType=t},expression:"friendPolicyType"}},[e._v("策略3")])],1)],1),e._v(" "),s("el-col",{attrs:{span:8,offset:1}},[s("label",{attrs:{for:"proving-qusetion"}},[e._v("验证问题:")]),e._v(" "),s("el-input",{attrs:{id:"proving-qusetion"},model:{value:e.provingQuesttion,callback:function(t){e.provingQuesttion=t},expression:"provingQuesttion"}})],1)],1)],1)},staticRenderFns:[]};var ne={name:"informationPushSetting",data:function(){return{friendLoginPush:!0,friendMessagePush:!0}},methods:{friendLoginPushChange:function(){alert(this.friendLoginPush)},friendMessagePushChange:function(){}}},ce={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"informationPushSetting"},[s("el-row",[s("el-col",{attrs:{span:4}},[s("label",[e._v("好友上线推送")])]),e._v(" "),s("el-col",{attrs:{span:4}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.friendLoginPushChange},model:{value:e.friendLoginPush,callback:function(t){e.friendLoginPush=t},expression:"friendLoginPush"}})],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:4}},[s("label",[e._v("好友信息推送")])]),e._v(" "),s("el-col",{attrs:{span:4}},[s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:e.friendMessagePushChange},model:{value:e.friendMessagePush,callback:function(t){e.friendMessagePush=t},expression:"friendMessagePush"}})],1)],1)],1)},staticRenderFns:[]};var de={name:"personal",data:function(){return{baseData:{},policyData:{}}},mounted:function(){this.getUserInfo()},methods:{getUserInfo:function(){var e=this;this.$http.post("/getUserInfo.do",{userId:sessionStorage.getItem("userId")}).then(function(t){t.data.success&&(e.baseData={nickName:t.data.data[0].U_NickName,age:t.data.data[0].U_Age,birthday:t.data.data[0].U_Birthday,phone:t.data.data[0].U_Telephone,email:t.data.data[0].U_Email,name:t.data.data[0].U_Name,sex:t.data.data[0].U_Sex},e.policyData={friendPolicyType:t.data.data[0].U_FriendshipPolicyID,provingPassword:t.data.data[0].U_FriendPolicyPassword,provingQuesttion:t.data.data[0].U_FriendPolicyQuestion})})}},components:{baseSetting:s("VU/8")(se,ae,!1,function(e){s("RTz0")},null,null).exports,changePassword:s("VU/8")(re,ie,!1,function(e){s("7/MD")},null,null).exports,friendPolicy:s("VU/8")({name:"friendPolicy",props:["data"],data:function(){return{friendPolicyType:0,provingPassword:"",provingQuesttion:""}},mounted:function(){},methods:{changeFriendPolicy:function(){1!==this.friendPolicyType||""!==this.provingPassword?2!==this.friendPolicyType||""!==this.provingQuesttion?this.$http.post("/updateUserInfo.do",{friendPolicyId:this.friendPolicyType,friendPolicyQuestion:""===this.provingQuesttion?null:this.provingQuesttion,friendPolicyPassword:""===this.provingPassword?null:this.provingPassword}).then(function(e){e.data.success}):this.$message.error("问题不能为空"):this.$message.error("密码不能为空")}},watch:{data:{handler:function(){this.friendPolicyType=this.data.friendPolicyType||0,this.provingPassword=this.data.provingPassword||"",this.provingQuesttion=this.data.provingQuesttion||""},deep:!0}}},oe,!1,function(e){s("sm3e")},null,null).exports,informationPushSetting:s("VU/8")(ne,ce,!1,function(e){s("qmwK")},null,null).exports}},le={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"personal"},[t("el-tabs",{staticStyle:{height:"200px"},attrs:{"tab-position":"left"}},[t("el-tab-pane",{attrs:{label:"基本资料"}},[t("baseSetting",{attrs:{data:this.baseData}})],1),this._v(" "),t("el-tab-pane",{attrs:{label:"修改密码"}},[t("changePassword")],1),this._v(" "),t("el-tab-pane",{attrs:{label:"好友策略"}},[t("friendPolicy",{attrs:{data:this.policyData}})],1),this._v(" "),t("el-tab-pane",{attrs:{label:"消息推送设置"}},[t("informationPushSetting")],1)],1)],1)},staticRenderFns:[]};var ue=s("VU/8")(de,le,!1,function(e){s("ZM7c")},null,null).exports,pe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:{remind:!0,checked:e.isChecked},on:{click:e.messageCheck}},["2"===e.data.messageType?a("div",[a("p",[e._v("你收到一条好友请求！")]),e._v(" "),a("p",{staticClass:"name"},[e._v("from:"+e._s(e.data.fromId))])]):e._e(),e._v(" "),"5"===e.data.messageType?a("div",[a("p",[e._v("对方拒绝了你的好友邀请！")]),e._v(" "),a("p",{staticClass:"name"},[e._v("from:"+e._s(e.data.fromId))])]):e._e(),e._v(" "),"3"===e.data.messageType?a("div",[a("p",[e._v("你又多了一位新朋友！")]),e._v(" "),a("p",{staticClass:"name"},[e._v("from:"+e._s(e.data.fromId))])]):e._e(),e._v(" "),"4"===e.data.messageType?a("div",[a("p",[e._v("你被对方从好友中删除！")]),e._v(" "),a("p",{staticClass:"name"},[e._v("from:"+e._s(e.data.fromId))])]):e._e(),e._v(" "),"1"===e.data.messageType?a("div",[a("img",{attrs:{src:s("EVuS"),alt:""}}),e._v(" "),a("span",[e._v(e._s(e.data.fromId))])]):e._e(),e._v(" "),"6"===e.data.messageType?a("div",[a("p",[e._v("你收到一条群请求！")]),e._v(" "),a("p",{staticClass:"name"},[e._v("from:"+e._s(e.data.fromId))])]):e._e()])},staticRenderFns:[]};var me={name:"myMessage",data:function(){return{remindList:[],checkedIndex:""}},components:{remind:s("VU/8")({name:"remind",props:["data","index","isChecked"],data:function(){return{}},methods:{messageCheck:function(){this.$emit("messageCheck",this.index)}}},pe,!1,function(e){s("/tZb")},null,null).exports},created:function(){this.getAllRemind()},methods:{joinGroup:function(){var e=this;this.$http.post("/joinGroup.do",{userId:this.$store.state.userId,groupId:this.remindList[this.checkedIndex].remark.groupId,id:this.remindList[this.checkedIndex].id}).then(function(t){t.data.success&&e.$message({message:"成功加群",type:"success"})})},messageCheck:function(e){this.checkedIndex=e},rejectRequest:function(){var e=this;this.$http.post("/rejectRequest.do",{toId:sessionStorage.getItem("userId"),fromId:this.remindList[this.checkedIndex].fromId,id:this.remindList[this.checkedIndex].id,messageType:this.remindList[this.checkedIndex].messageType}).then(function(t){t.data.success&&e.$message({message:"已拒绝",type:"success"})})},addFriend:function(){var e=this;this.$http.post("/addFriend.do",{userId:sessionStorage.getItem("userId"),friendId:this.remindList[this.checkedIndex].fromId}).then(function(t){t.data.success&&("添加成功"===t.data.msg?(e.$message({message:t.data.msg,type:"success"}),e.$http.post("/deleteRemind.do",{id:e.remindList[e.checkedIndex].id}).then(function(e){e.data.success})):e.$message.error(t.data.msg))})},getAllRemind:function(){var e=this;this.$http.post("/getAllRemind.do",{userId:sessionStorage.getItem("userId")}).then(function(t){if(t.data.success){var s=[];t.data.data.forEach(function(e){s.push({fromId:e.UM_FromID,message:e.UM_Message,time:function(e,t){var s=new Date(e),a=s.getFullYear(),r=s.getMonth()+1;r<10&&(r="0"+r);var i=s.getDate();i<10&&(i="0"+i);var o=s.getHours();o<10&&(o="0"+o);var n=s.getMinutes();n<10&&(n="0"+n);var c=s.getSeconds();return c<10&&(c="0"+c),t.replace(/yyyy/,a).replace(/MM/,r).replace(/dd/,i).replace(/HH/,o).replace(/mm/,n).replace(/ss/,c)}(parseInt(e.UM_Time),"yyyy-MM-dd HH:mm"),messageType:e.UM_MessageType,remark:"6"===e.UM_MessageType?JSON.parse(e.UM_Remark):e.UM_Remark,id:e.UM_ID})}),e.remindList=s,console.log(e.remindList)}})}}},ge={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"myMessage"},[s("el-container",[s("el-aside",{attrs:{width:"200px"}},[s("div",{staticClass:"message-group"},e._l(e.remindList,function(t,a){return s("remind",{key:a,attrs:{data:t,index:a,isChecked:e.checkedIndex===a},on:{messageCheck:e.messageCheck}})}))]),e._v(" "),s("el-container",[""!==e.checkedIndex?s("div",{staticClass:"detail"},["2"===e.remindList[e.checkedIndex].messageType?s("div",{staticClass:"proving"},[s("p",[e._v("ID:"+e._s(e.remindList[e.checkedIndex].fromId)+"向您发来好友验证:")]),e._v(" "),s("p",{staticClass:"question"},[e._v("您的问题:"+e._s(e.remindList[e.checkedIndex].remark))]),e._v(" "),s("p",{staticClass:"answer"},[e._v("对方回答:"+e._s(e.remindList[e.checkedIndex].message))]),e._v(" "),s("p",{staticClass:"time"},[e._v("日期:"+e._s(e.remindList[e.checkedIndex].time))]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.addFriend}},[e._v("同意")]),e._v(" "),s("el-button",{attrs:{type:"danger"},on:{click:e.rejectRequest}},[e._v("拒绝")])],1):e._e(),e._v(" "),"5"===e.remindList[e.checkedIndex].messageType?s("div",{staticClass:"proving"},[s("p",[e._v("ID:"+e._s(e.remindList[e.checkedIndex].fromId)+"拒绝了你的好友邀请:")]),e._v(" "),s("p",{staticClass:"question"},[e._v("对方的问题:"+e._s(e.remindList[e.checkedIndex].remark))]),e._v(" "),s("p",{staticClass:"answer"},[e._v("您回答:"+e._s(e.remindList[e.checkedIndex].message))]),e._v(" "),s("p",{staticClass:"time"},[e._v("日期:"+e._s(e.remindList[e.checkedIndex].time))])]):e._e(),e._v(" "),"6"===e.remindList[e.checkedIndex].messageType?s("div",{staticClass:"proving"},[s("p",[e._v("ID:"+e._s(e.remindList[e.checkedIndex].fromId)+"邀你加入群:"+e._s(e.remindList[e.checkedIndex].remark.groupName))]),e._v(" "),s("p",{staticClass:"time"},[e._v("日期:"+e._s(e.remindList[e.checkedIndex].time))]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.joinGroup}},[e._v("同意")]),e._v(" "),s("el-button",{attrs:{type:"danger"},on:{click:e.rejectRequest}},[e._v("拒绝")])],1):e._e()]):e._e()])],1)],1)},staticRenderFns:[]};var he=s("VU/8")(me,ge,!1,function(e){s("EUih")},null,null).exports;a.default.use(o.a);var fe=new o.a({routes:[{path:"/",name:"login",component:$},{path:"/login",name:"login",component:$},{path:"/home",name:"home",component:b,children:[{path:"/home/myFriend",name:"myFriend",component:H},{path:"/home/personal",name:"personal",component:ue},{path:"/home/myMessage",name:"myMessage",component:he},{path:"/home/myGroups",name:"myGroups",component:K}]}]}),ve=s("9rMa"),Ie=s("OTK7"),_e=s.n(Ie);s("ENLC");a.default.use(f.a),a.default.use(ve.a);var ke=new ve.a.Store({mode:"history",state:{statisFileIp:"192.168.2.72:8081",isVideo:!1,nickName:null,userId:null,socket:null},mutations:{},actions:{connectSocket:function(e){e.state.socket=_e.a.connect(),e.state.socket.emit("login",this.state.userId),e.state.socket.on("loginSuccess",function(e){(new a.default).$message({message:"socket连接成功",type:"success"})}),e.state.socket.on("getMessage",function(e){(new a.default).$message({message:"你收到一条消息",type:"success"})}),e.state.socket.on("sendError",function(){(new a.default).$message.error("发送失败")}),e.state.socket.on("sendSuccess",function(){(new a.default).$message.error("发送成功")})}}}),we=s("aozt"),ye=s.n(we);ye.a.interceptors.response.use(function(e){return e.data.success||e.data.msg&&h.Message.error(e.data.msg),e});var be=ye.a;s("HBSQ"),s("r7R4");a.default.use(f.a),a.default.use(ve.a),a.default.prototype.$http=be,a.default.config.productionTip=!1,new a.default({el:"#app",router:fe,store:ke,components:{App:i},template:"<App/>"})},RTz0:function(e,t){},SmrQ:function(e,t){},"UIj/":function(e,t){},WGRq:function(e,t){},YVzM:function(e,t){},ZM7c:function(e,t){},b3kr:function(e,t){},bIQm:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAAA9CAYAAABP2pDPAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkRCMEQ0OTg3Mjc0NTExRThBNjFGQjIyRjNBQURFMUU1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkRCMEQ0OTg4Mjc0NTExRThBNjFGQjIyRjNBQURFMUU1Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6REIwRDQ5ODUyNzQ1MTFFOEE2MUZCMjJGM0FBREUxRTUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6REIwRDQ5ODYyNzQ1MTFFOEE2MUZCMjJGM0FBREUxRTUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz58kfYtAAAFq0lEQVR42uyczXXbOBDH4X057C10BaEvuZquwEwFkSqIVIHlCkRVYKkCyRVYqUB0BeFeczG3goVve/MK7w3iWQTfZETEnP97eI4cCgSBH2YGA9BnLy8vjETqW2cEFonAIhFYJAKLeoFEYJEILBKBRSIRWCQCi0RgkUgEFonAIhFYJBKBRSKwSATWyfTvx4+/a5/lUKT4sTSpNvbP798Hue+7BAetOJbLYynh3+cJtGt2LJ+hTZnhmvpY7o9ldwKYWyhksTQWSweRbtDOBuwf0a6tMqguiQGfdrRimQIzs8D8FWDmKVmsIcHyubEYnCtL55cAptAzdHRfbmkGUMWIQ7vbCKBujmVhsYym+93qrOUYXWHtmI3MMAtL6PyJpd4V/IzVxAKVqHcDPzm6/gtqk4BieSzznqxji6DJ4D65AqRs744loCEt1sEDLDF4n5TBWnjeYh7ZyeI+TwaL4apTtK9Ck8I3PjRZxwZCBNwPUqIf7jQT8QJPyKEs1h8DQt0EDvYhACoGAzWJtFY6qPYaqAqAsIDPG6XNXaCagzvlqH6sNbg/tZ8mLAENCRYPhKqIuMc2MFYRujb8/l7zuwdwSbFxXWmACsdLe+UZcuiPpaHOD2MH62/POEyFagcz+QxcTeURDIcu7X0nQo7ckgpJ7TFhHgzPvEafH5F1xJaw0rhC335902D5rJgWqEM5xBlzZCE4BOprRx196NoAAYMBPihu6N5R353Bmq40LrhC/dVAP5xrXCGH6wksj1mNoTJZgY1HTqhr7LfQuONbw3NUjiA/t7TpBv4vUyYP10DENXEZTwGsobd0fG4uoXLFMU8WNyZm8TQg7jlY2jLVAJ6je/ukObaesNvara5etSvWMa4KfQP4W8/guHXA4qvaAodcSKhurHV8T7fy1GkK6QIJSeOwenKf8oolkr9KxWK5clkhlsZV11XA6k24vG8eIM9ZeCLWVvcFC8vWZ67JOVaL5dIm0grOwX1WyoCGxFmurLlc9j8EpjTyjnFnTMpmdGDVv6DOHZQagl5ppS4j6pl6DN4EYh3fxOQlG4FSt1gxiUdu+Fw4XMoCxU85csWfPOCSOaltT8+dsbiEMIEFevwFpn6GwChR3FVaXNMTAFUCYNgCNRD7NJ737pI3WwKg/wDkGYGVjiQoL5q0QWEYTN0A3mlSHj6u+84RRz1b/q9CQO8JrNO6ui4phSJg6Z8r10u4fDLbN5HPLFea5/CzJbDixHtcIcUGzqHu1mfAy0iwMmY5DUpg9WO12g6witWc3KTeOSzWztKuxpLOCLWM+PuNBayl8nnm6f5x0nbw4D8FsPqenTvkrrhiYXSdvdHETq0DnrqjRbXl5+SeZAEx4lYDW6nEX3JVK936Fr47GzNY7QlAbdEA5JrrRex0BcGzPGDniv/2HSbLzvLcGQKjgGtXyspTPUrUQH1L9nrKIhsyRnv3BsHKNQNVKG6q1biuJnAxwTsuSubMvNldIMuoWs73FiuKUy0x201vymI9WzoqRjOYuSXMXDUfpAbwWxaXM7Jd/9Xj++L51h6LgINh5XqNYjDV7cWe9+9NKbwJXRpmbsV+PvRmk++D1Oz1xQT88kPIhreQ7ZhOyGay7xEabOFzhyX8AdWYN6FPvbTGbhFn/uUrXz6Wa2EZ3HWge58z+/Fql6vHwCVzfCbldAProbNr6OgKrNQF+/8rWao7EpbjG7NvKOteu8LPsopo/wqgqCMnZsXCjgWNwhVKN9agHA8Ha1IHWKEbmLWPLPxvG+jcUasE9Dm47dwClc+Gtc+zfGGvf3bABFMNsdzeds8xvmLPEtMy0CV1iQdDQVNPq3pPGgIrDeUAmE8wLd+IWbGE9/QIrLQk3yi+ZD9vRAuX9xdL5DUrAos0KhFYJAKLRGCRCCwCi0RgkQgsEoFFIhFYJAKLRGCRSAQWKXn9J8AAZe/vg12Ay0kAAAAASUVORK5CYII="},mjfy:function(e,t){},oAad:function(e,t){},qmwK:function(e,t){},r7R4:function(e,t){},rjtC:function(e,t){},sVCO:function(e,t){},sm3e:function(e,t){},uLvx:function(e,t){},vZcv:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.824f39a1760d16b16675.js.map
